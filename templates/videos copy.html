<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¡€æ ·å¼ - å¾®ä¿¡é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #f7f7f7;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* å¯¼èˆªæ  - ç®€æ´è®¾è®¡ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #fff;
            border-bottom: 1px solid #e6e6e6;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            text-decoration: none;
        }

        .logo i {
            font-size: 20px;
            color: #07c160;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 24px;
        }

        .nav-links a {
            color: #666;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #07c160;
            background-color: #f0f9f0;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 76px 20px 20px;
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #999;
            font-size: 14px;
        }

        /* é¢„åŠ è½½æŒ‡ç¤ºå™¨ */
        .preload-indicator {
            position: fixed;
            top: 76px;
            left: 20px;
            background: rgba(7, 193, 96, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1500;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .preload-indicator.show {
            transform: translateY(0);
            opacity: 1;
        }

        .preload-indicator i {
            font-size: 12px;
            animation: spin 1s linear infinite;
        }

        /* è§†é¢‘åº“å¤´éƒ¨ */
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .library-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: #f8f8f8;
            color: #666;
            border: 1px solid #e6e6e6;
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .action-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        /* è®¾ç½®æŒ‰é’® */
        .settings-btn {
            background: #07c160;
            color: white;
            border: 1px solid #07c160;
        }

        .settings-btn:hover {
            background: #06a850;
            color: white;
        }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .settings-content {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            margin: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .settings-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 20px;
            color: #999;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-settings:hover {
            background: #f0f0f0;
            color: #333;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .setting-desc {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        /* å¼€å…³æŒ‰é’® */
        .switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #ddd;
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .switch.active {
            background: #07c160;
        }

        .switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .switch.active::before {
            transform: translateX(24px);
        }

        /* è§†é¢‘ç½‘æ ¼ */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* è§†é¢‘å¡ç‰‡ - åŒ…å«æ’­æ”¾å™¨ */
        .video-card {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
        }

        .video-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .video-card.playing {
            box-shadow: 0 4px 24px rgba(7, 193, 96, 0.2);
            border: 2px solid #07c160;
        }

        /* è§†é¢‘æ’­æ”¾å™¨å®¹å™¨ */
        .video-player-container {
            position: relative;
            aspect-ratio: 16/9;
            background: #000;
            overflow: hidden;
        }

        /* è§†é¢‘ç¼©ç•¥å›¾æ ·å¼ */
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            pointer-events: none;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .video-thumbnail.loaded {
            opacity: 1;
        }

        .video-thumbnail.loading {
            opacity: 0.7;
        }

        /* ä¸»æ’­æ”¾å™¨æ ·å¼ */
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
        }

        /* å½“å¯ç”¨ç‚¹å‡»æ’­æ”¾æ—¶ï¼Œæ¢å¤videoçš„æŒ‡é’ˆäº‹ä»¶ */
        .video-player-container.click-enabled .video-player {
            pointer-events: auto;
            cursor: pointer;
        }

        /* ç¼©ç•¥å›¾åŠ è½½å ä½ç¬¦ */
        .thumbnail-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f0f0f0 0%, #e8e8e8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            z-index: 0;
        }

        .thumbnail-placeholder i {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        /* æ’­æ”¾æŒ‰é’®é®ç½© */
        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 3;
        }

        .play-overlay:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-button {
            width: 60px;
            height: 60px;
            background: rgba(7, 193, 96, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .play-button:hover {
            transform: scale(1.1);
            background: #07c160;
        }

        .play-button i {
            color: white;
            font-size: 24px;
            margin-left: 3px;
        }

        /* è§†é¢‘åŠ è½½æŒ‡ç¤ºå™¨ */
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            display: none;
            z-index: 4;
        }

        .video-loading.show {
            display: block;
            animation: spin 1s linear infinite;
        }

        /* é¢„åŠ è½½æ ‡è®° */
        .preload-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(7, 193, 96, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 5;
            backdrop-filter: blur(4px);
        }

        /* ç¼©ç•¥å›¾åŠ è½½æ ‡è®° */
        .thumbnail-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: none;
            align-items: center;
            gap: 4px;
            z-index: 5;
            backdrop-filter: blur(4px);
        }

        .thumbnail-badge.show {
            display: flex;
        }

        /* è§†é¢‘ä¿¡æ¯ */
        .video-info {
            padding: 16px;
            border-top: 1px solid #f0f0f0;
        }

        .video-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #999;
            font-size: 12px;
        }

        .video-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* è§†é¢‘æ§åˆ¶æ  */
        .video-controls {
            padding: 12px 16px;
            background: #f8f8f8;
            display: flex;
            gap: 8px;
            justify-content: center;
            border-top: 1px solid #e6e6e6;
        }

        .control-btn {
            background: #fff;
            color: #666;
            border: 1px solid #e6e6e6;
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .control-btn:hover {
            background: #07c160;
            color: white;
            border-color: #07c160;
        }

        .control-btn.active {
            background: #07c160;
            color: white;
            border-color: #07c160;
        }

        /* éŸ³é‡æ§åˆ¶ */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .volume-slider {
            width: 60px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: #07c160;
            border-radius: 50%;
            cursor: pointer;
        }

        /* çŠ¶æ€å’Œé€šçŸ¥ */
        .loading {
            display: none;
            text-align: center;
            padding: 40px 20px;
            color: #999;
            background: #fff;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .loading i {
            font-size: 24px;
            animation: spin 1s linear infinite;
            margin-bottom: 12px;
            color: #07c160;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            display: none;
            background: #fff;
            border-radius: 12px;
        }

        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 16px;
        }

        .notification {
            position: fixed;
            top: 76px;
            right: 20px;
            background: #fff;
            color: #333;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid #e6e6e6;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transform: translateX(120%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
            min-width: 240px;
            max-width: 320px;
            font-size: 14px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.success {
            border-left: 4px solid #07c160;
        }

        .notification.error {
            border-left: 4px solid #fa5151;
        }

        .notification i {
            margin-right: 8px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 66px 16px 16px;
            }

            .nav-links {
                display: none;
            }

            .video-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .library-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .page-header h1 {
                font-size: 24px;
            }

            .play-button {
                width: 50px;
                height: 50px;
            }

            .play-button i {
                font-size: 20px;
            }

            .notification {
                right: 16px;
                left: 16px;
                min-width: auto;
                max-width: none;
                text-align: center;
            }

            .preload-indicator {
                left: 16px;
                font-size: 11px;
                padding: 6px 10px;
            }

            .volume-slider {
                display: none;
            }

            .settings-content {
                margin: 10px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .video-controls {
                padding: 8px 12px;
                gap: 4px;
            }

            .control-btn {
                padding: 4px 8px;
                font-size: 11px;
            }

            .control-btn span {
                display: none;
            }

            .video-info {
                padding: 12px;
            }

            .video-title {
                font-size: 13px;
            }

            .video-meta {
                font-size: 11px;
            }
        }

        /* å…¨å±æ ·å¼ */
        .video-card.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            border-radius: 0;
            width: 100%;
            height: 100%;
        }

        .video-card.fullscreen .video-player-container {
            height: calc(100% - 120px);
        }

        .video-card.fullscreen .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
        }

        .video-card.fullscreen .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        ::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        /* åŠ¨ç”» */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ç¼©ç•¥å›¾æ·¡å…¥åŠ¨ç”» */
        @keyframes thumbnailFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-thumbnail.fade-in {
            animation: thumbnailFadeIn 0.5s ease-in-out;
        }

        /* é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢ç¼©æ”¾ */
        html {
            touch-action: pan-x pan-y;
            -webkit-text-size-adjust: none;
            -ms-text-size-adjust: none;
        }

        /* ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸé€‚é… */
        @supports (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: env(safe-area-inset-top);
                height: calc(56px + env(safe-area-inset-top));
            }

            .container {
                padding-top: calc(76px + env(safe-area-inset-top));
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <header class="header" id="header">
        <div class="nav-container">
            <a href="#" class="logo">
                <i class="fas fa-play-circle"></i> è§†é¢‘ä¸­å¿ƒ
            </a>
            <ul class="nav-links">
                <li><a href="#" class="active">è§†é¢‘åº“</a></li>
                <li><a href="#" onclick="showAbout()">å…³äºæˆ‘ä»¬</a></li>
                <li><a href="#" onclick="showContact()">è”ç³»æ–¹å¼</a></li>
            </ul>
        </div>
    </header>

    <!-- é¢„åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div class="preload-indicator" id="preloadIndicator">
        <i class="fas fa-spinner"></i>
        <span>æ­£åœ¨é¢„åŠ è½½è§†é¢‘...</span>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1>å‡¤å‡°çœ¼è§†è§‰  å¼€å¯é«˜ç»´æ™ºèƒ½è§‚èµ›æ–°æ—¶ä»£</h1>
            <p>è§†é¢‘å±•ç¤ºä¸­å¿ƒ</p>
        </div>

        <!-- è§†é¢‘åº“å¤´éƒ¨ -->
        <div class="library-header">
            <h2>è§†é¢‘åº“</h2>
            <div class="header-actions">
                <button class="action-btn settings-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i> è®¾ç½®
                </button>
                <button class="action-btn" onclick="stopAllVideos()">
                    <i class="fas fa-stop"></i> åœæ­¢å…¨éƒ¨
                </button>
                <button class="action-btn" onclick="refreshVideoList()">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°
                </button>
            </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading">
            <i class="fas fa-spinner"></i>
            <p>æ­£åœ¨åŠ è½½è§†é¢‘åˆ—è¡¨...</p>
        </div>

        <!-- è§†é¢‘ç½‘æ ¼ -->
        <div class="video-grid" id="videoGrid">
            <!-- è§†é¢‘åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState">
            <i class="fas fa-video-slash"></i>
            <h3>æš‚æ— è§†é¢‘å†…å®¹</h3>
            <p>è¯·æ·»åŠ è§†é¢‘æ–‡ä»¶åˆ°æœåŠ¡å™¨</p>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel" id="settingsPanel" onclick="hideSettings(event)">
        <div class="settings-content" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h3>æ’­æ”¾è®¾ç½®</h3>
                <button class="close-settings" onclick="hideSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">ç‚¹å‡»è§†é¢‘æ’­æ”¾/æš‚åœ</div>
                    <div class="setting-desc">å¯ç”¨åå¯ä»¥ç›´æ¥ç‚¹å‡»è§†é¢‘åŒºåŸŸæ§åˆ¶æ’­æ”¾</div>
                </div>
                <div class="switch" id="clickToPlaySwitch" onclick="toggleClickToPlay()">
                </div>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘</div>
                    <div class="setting-desc">æ’­æ”¾æ–°è§†é¢‘æ—¶è‡ªåŠ¨åœæ­¢å…¶ä»–æ­£åœ¨æ’­æ”¾çš„è§†é¢‘</div>
                </div>
                <div class="switch active" id="autoStopSwitch" onclick="toggleAutoStop()">
                </div>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">é¢„åŠ è½½è§†é¢‘</div>
                    <div class="setting-desc">é¢„å…ˆåŠ è½½éƒ¨åˆ†è§†é¢‘ä»¥æé«˜æ’­æ”¾æµç•…åº¦</div>
                </div>
                <div class="switch active" id="preloadSwitch" onclick="togglePreload()">
                </div>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">è‡ªåŠ¨åŠ è½½å°é¢</div>
                    <div class="setting-desc">é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºè§†é¢‘å°é¢</div>
                </div>
                <div class="switch active" id="thumbnailSwitch" onclick="toggleThumbnail()">
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let videoList = [];
        let activeVideos = new Map(); // å­˜å‚¨æ´»åŠ¨çš„è§†é¢‘æ’­æ”¾å™¨
        let preloadedVideos = new Set();
        let thumbnailsLoaded = new Set();
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let userHasInteracted = false;

        // ç”¨æˆ·è®¾ç½®
        let settings = {
            clickToPlay: false,   // é»˜è®¤ç¦ç”¨ç‚¹å‡»æ’­æ”¾ï¼ˆç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯ï¼‰
            autoStop: true,       // è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘
            preload: true,        // é¢„åŠ è½½è§†é¢‘
            thumbnail: true       // è‡ªåŠ¨åŠ è½½å°é¢
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ å¼€å§‹åŠ è½½è§†é¢‘åˆ—è¡¨...');
            loadSettings();
            loadVideoList();
            setupUserInteractionTracking();
            setupMobileOptimizations();
            setupKeyboardControls();
        });

        // åŠ è½½ç”¨æˆ·è®¾ç½®
        function loadSettings() {
            // ç§»åŠ¨ç«¯é»˜è®¤ç¦ç”¨ç‚¹å‡»æ’­æ”¾åŠŸèƒ½
            if (isMobile) {
                settings.clickToPlay = false;
            }
            
            updateSettingsUI();
        }

        // æ›´æ–°è®¾ç½®ç•Œé¢
        function updateSettingsUI() {
            document.getElementById('clickToPlaySwitch').classList.toggle('active', settings.clickToPlay);
            document.getElementById('autoStopSwitch').classList.toggle('active', settings.autoStop);
            document.getElementById('preloadSwitch').classList.toggle('active', settings.preload);
            document.getElementById('thumbnailSwitch').classList.toggle('active', settings.thumbnail);
        }

        // æ˜¾ç¤ºè®¾ç½®é¢æ¿
        function showSettings() {
            document.getElementById('settingsPanel').style.display = 'flex';
            updateSettingsUI();
        }

        // éšè—è®¾ç½®é¢æ¿
        function hideSettings(event) {
            if (!event || event.target.id === 'settingsPanel') {
                document.getElementById('settingsPanel').style.display = 'none';
            }
        }

        // åˆ‡æ¢ç‚¹å‡»æ’­æ”¾è®¾ç½®
        function toggleClickToPlay() {
            settings.clickToPlay = !settings.clickToPlay;
            updateSettingsUI();
            applyClickToPlaySetting();
            showNotification(
                settings.clickToPlay ? 'å·²å¯ç”¨ç‚¹å‡»è§†é¢‘æ’­æ”¾/æš‚åœ' : 'å·²ç¦ç”¨ç‚¹å‡»è§†é¢‘æ’­æ”¾/æš‚åœ', 
                'success'
            );
        }

        // åº”ç”¨ç‚¹å‡»æ’­æ”¾è®¾ç½®
        function applyClickToPlaySetting() {
            const containers = document.querySelectorAll('.video-player-container');
            containers.forEach(container => {
                if (settings.clickToPlay) {
                    container.classList.add('click-enabled');
                } else {
                    container.classList.remove('click-enabled');
                }
            });
        }

        // åˆ‡æ¢è‡ªåŠ¨åœæ­¢è®¾ç½®
        function toggleAutoStop() {
            settings.autoStop = !settings.autoStop;
            updateSettingsUI();
            showNotification(
                settings.autoStop ? 'å·²å¯ç”¨è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘' : 'å·²ç¦ç”¨è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘', 
                'success'
            );
        }

        // åˆ‡æ¢é¢„åŠ è½½è®¾ç½®
        function togglePreload() {
            settings.preload = !settings.preload;
            updateSettingsUI();
            showNotification(
                settings.preload ? 'å·²å¯ç”¨è§†é¢‘é¢„åŠ è½½' : 'å·²ç¦ç”¨è§†é¢‘é¢„åŠ è½½', 
                'success'
            );
        }

        // åˆ‡æ¢å°é¢è®¾ç½®
        function toggleThumbnail() {
            settings.thumbnail = !settings.thumbnail;
            updateSettingsUI();
            showNotification(
                settings.thumbnail ? 'å·²å¯ç”¨è‡ªåŠ¨åŠ è½½å°é¢' : 'å·²ç¦ç”¨è‡ªåŠ¨åŠ è½½å°é¢', 
                'success'
            );
            
            if (settings.thumbnail && videoList.length > 0) {
                loadThumbnails();
            }
        }

        // åŠ è½½è§†é¢‘åˆ—è¡¨
        async function loadVideoList() {
            try {
                showLoading(true);
                showPreloadIndicator(true, 'æ­£åœ¨è·å–è§†é¢‘åˆ—è¡¨...');
                
                const response = await fetch('/api/get_video_list');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    videoList = data.videos || [];
                    
                    if (videoList.length > 0) {
                        renderVideoGrid();
                        showNotification(`æˆåŠŸåŠ è½½ ${videoList.length} ä¸ªè§†é¢‘`, 'success');
                        
                        // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦é¢„åŠ è½½
                        if (settings.preload) {
                            preloadVideos();
                        }

                        // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åŠ è½½å°é¢
                        if (settings.thumbnail) {
                            loadThumbnails();
                        }
                    } else {
                        showEmptyState();
                    }
                } else {
                    throw new Error(data.message || 'è·å–è§†é¢‘åˆ—è¡¨å¤±è´¥');
                }
                
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', error);
                showNotification('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
                showEmptyState();
            } finally {
                showLoading(false);
                showPreloadIndicator(false);
            }
        }

        // æ¸²æŸ“è§†é¢‘ç½‘æ ¼
        function renderVideoGrid() {
            const videoGrid = document.getElementById('videoGrid');
            const emptyState = document.getElementById('emptyState');
            
            emptyState.style.display = 'none';
            videoGrid.innerHTML = '';
            videoGrid.style.display = 'grid';

            videoList.forEach((video, index) => {
                const card = createVideoCard(video, index);
                videoGrid.appendChild(card);
            });

            // åº”ç”¨ç‚¹å‡»æ’­æ”¾è®¾ç½®
            applyClickToPlaySetting();
        }

        // åˆ›å»ºè§†é¢‘å¡ç‰‡ï¼ˆåŒ…å«æ’­æ”¾å™¨å’Œç¼©ç•¥å›¾ï¼‰
        function createVideoCard(video, index) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `video-card-${index}`;
            card.setAttribute('data-index', index);
            card.setAttribute('data-filename', video.filename);

            const sizeText = video.size ? formatFileSize(video.size) : 'æœªçŸ¥å¤§å°';
            const modifiedText = video.modified ? formatDate(new Date(video.modified)) : 'æœªçŸ¥æ—¥æœŸ';

            card.innerHTML = `
                <div class="video-player-container" id="player-container-${index}">
                    <!-- ç¼©ç•¥å›¾å ä½ç¬¦ -->
                    <div class="thumbnail-placeholder" id="placeholder-${index}">
                        <div style="text-align: center;">
                            <i class="fas fa-video"></i>
                            
                        </div>
                    </div>
                    
                    <!-- ç¼©ç•¥å›¾è§†é¢‘ - ç”¨äºæ˜¾ç¤ºå°é¢ -->
                    <video 
                        id="thumbnail-${index}" 
                        class="video-thumbnail"
                        preload="metadata"
                        muted
                        playsinline 
                        webkit-playsinline
                        style="display: none;">
                        <source src="/api/video_thumbnail/${encodeURIComponent(video.filename)}" type="video/mp4">
                    </video>
                    
                    <!-- ä¸»æ’­æ”¾å™¨ -->
                    <video 
                        id="video-${index}" 
                        class="video-player"
                        preload="none"
                        playsinline 
                        webkit-playsinline
                        controls
                        style="display: none;">
                        <source src="/api/stream_video/${encodeURIComponent(video.filename)}" type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                    </video>
                    
                    <div class="play-overlay" id="overlay-${index}" onclick="playVideo(${index})">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    
                    <div class="video-loading" id="loading-${index}">
                        <i class="fas fa-spinner"></i>
                    </div>
                    


                </div>
                
                <div class="video-info">
                    <div class="video-title" title="${video.filename}">
                        ${video.name || video.filename}
                    </div>
                    <div class="video-meta">
                        <span><i class="fas fa-file"></i> ${sizeText}</span>
                        <span><i class="fas fa-calendar"></i> ${modifiedText}</span>
                    </div>
                </div>
                
                <div class="video-controls">
                    <button class="control-btn" onclick="togglePlayPause(${index})" id="play-btn-${index}">
                        <i class="fas fa-play"></i>
                        <span>æ’­æ”¾</span>
                    </button>
                    <button class="control-btn" onclick="toggleMute(${index})">
                        <i class="fas fa-volume-up"></i>
                        <span>é™éŸ³</span>
                    </button>
                    <div class="volume-control">
                        <input type="range" class="volume-slider" id="volume-${index}" 
                               min="0" max="100" value="100" 
                               oninput="changeVolume(${index}, this.value)">
                    </div>
                    <button class="control-btn" onclick="toggleFullscreen(${index})">
                        <i class="fas fa-expand"></i>
                        <span>å…¨å±</span>
                    </button>
                    <button class="control-btn" onclick="downloadVideo('${video.filename}')">
                        <i class="fas fa-download"></i>
                        <span>ä¸‹è½½</span>
                    </button>
                </div>
            `;

            // è®¾ç½®è§†é¢‘äº‹ä»¶ç›‘å¬
            setTimeout(() => {
                setupVideoEvents(index);
            }, 0);

            return card;
        }

        // è®¾ç½®è§†é¢‘äº‹ä»¶ç›‘å¬
        function setupVideoEvents(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            
            if (!video) return;

            // è®¾ç½®ç¼©ç•¥å›¾äº‹ä»¶
            if (thumbnail) {
                thumbnail.addEventListener('loadeddata', () => {
                    console.log(`ç¼©ç•¥å›¾ ${index} æ•°æ®åŠ è½½å®Œæˆ`);
                    
                    // è·³åˆ°ç¬¬2ç§’è·å–æ›´å¥½çš„å°é¢å¸§
                    thumbnail.currentTime = 0.5;
                    
                    setTimeout(() => {
                        thumbnail.pause();
                        showThumbnail(index);
                        thumbnailsLoaded.add(index);
                    }, 500);
                });

                thumbnail.addEventListener('loadedmetadata', () => {
                    console.log(`ç¼©ç•¥å›¾ ${index} å…ƒæ•°æ®åŠ è½½å®Œæˆ`);
                });

                thumbnail.addEventListener('error', (e) => {
                    console.warn(`ç¼©ç•¥å›¾ ${index} åŠ è½½å¤±è´¥:`, e);
                    showThumbnailError(index);
                });

                thumbnail.addEventListener('timeupdate', () => {
                    // ç¡®ä¿åœ¨ç¬¬2ç§’æš‚åœ
                    if (thumbnail.currentTime >= 2) {
                        thumbnail.pause();
                    }
                });
            }

            // ä¸»æ’­æ”¾å™¨äº‹ä»¶ç›‘å¬
            video.addEventListener('loadstart', () => {
                console.log(`è§†é¢‘ ${index} å¼€å§‹åŠ è½½`);
                showLoadingIndicator(index, true);
            });

            video.addEventListener('loadeddata', () => {
                console.log(`è§†é¢‘ ${index} æ•°æ®å·²åŠ è½½`);
                showLoadingIndicator(index, false);
            });

            video.addEventListener('play', () => {
                console.log(`è§†é¢‘ ${index} å¼€å§‹æ’­æ”¾`);
                updatePlayButton(index, true);
                document.getElementById(`video-card-${index}`).classList.add('playing');
                
                // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åœæ­¢å…¶ä»–è§†é¢‘
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
            });

            video.addEventListener('pause', () => {
                console.log(`è§†é¢‘ ${index} æš‚åœ`);
                updatePlayButton(index, false);
                document.getElementById(`video-card-${index}`).classList.remove('playing');
            });

            video.addEventListener('ended', () => {
                console.log(`è§†é¢‘ ${index} æ’­æ”¾ç»“æŸ`);
                resetVideo(index);
                showNotification('è§†é¢‘æ’­æ”¾å®Œæˆ', 'success');
            });

            video.addEventListener('error', (e) => {
                console.error(`è§†é¢‘ ${index} åŠ è½½å¤±è´¥:`, e);
                showLoadingIndicator(index, false);
                showNotification('è§†é¢‘åŠ è½½å¤±è´¥', 'error');
            });

            // åªæœ‰åœ¨å¯ç”¨ç‚¹å‡»æ’­æ”¾æ—¶æ‰æ·»åŠ ç‚¹å‡»äº‹ä»¶
            video.addEventListener('click', (e) => {
                if (settings.clickToPlay) {
                    e.stopPropagation();
                    togglePlayPause(index);
                }
            });
        }

        // æ˜¾ç¤ºç¼©ç•¥å›¾
        function showThumbnail(index) {
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const placeholder = document.getElementById(`placeholder-${index}`);
            const badge = document.getElementById(`thumb-badge-${index}`);
            
            if (thumbnail && placeholder) {
                placeholder.style.display = 'none';
                thumbnail.style.display = 'block';
                thumbnail.classList.add('loaded', 'fade-in');
                
                if (badge) {
                    badge.classList.add('show');
                }
                
                console.log(`âœ… ç¼©ç•¥å›¾æ˜¾ç¤ºæˆåŠŸ: ${index}`);
            }
        }

        // æ˜¾ç¤ºç¼©ç•¥å›¾é”™è¯¯
        function showThumbnailError(index) {
            const placeholder = document.getElementById(`placeholder-${index}`);
            
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="text-align: center; color: #999;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>å°é¢åŠ è½½å¤±è´¥</div>
                    </div>
                `;
            }
        }

        // åŠ è½½æ‰€æœ‰ç¼©ç•¥å›¾
        function loadThumbnails() {
            if (!settings.thumbnail) return;
            
            showPreloadIndicator(true, 'æ­£åœ¨åŠ è½½è§†é¢‘å°é¢...');
            
            let loadedCount = 0;
            const totalCount = videoList.length;
            
            videoList.forEach((video, index) => {
                const thumbnail = document.getElementById(`thumbnail-${index}`);
                if (thumbnail && !thumbnailsLoaded.has(index)) {
                    // è§¦å‘ç¼©ç•¥å›¾åŠ è½½
                    thumbnail.load();
                    
                    const checkLoaded = () => {
                        loadedCount++;
                        if (loadedCount >= totalCount) {
                            showPreloadIndicator(false);
                            showNotification(`å°é¢åŠ è½½å®Œæˆ (${thumbnailsLoaded.size}/${totalCount})`, 'success');
                        }
                    };

                    thumbnail.addEventListener('loadeddata', checkLoaded, { once: true });
                    thumbnail.addEventListener('error', checkLoaded, { once: true });
                }
            });
            
            // è®¾ç½®è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
            setTimeout(() => {
                if (loadedCount < totalCount) {
                    showPreloadIndicator(false);
                    showNotification(`å°é¢åŠ è½½å®Œæˆ (${thumbnailsLoaded.size}/${totalCount})`, 'success');
                }
            }, 10000); // 10ç§’è¶…æ—¶
        }

        // æ’­æ”¾è§†é¢‘
        async function playVideo(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const loadingIndicator = document.getElementById(`loading-${index}`);
            
            if (!video) return;

            try {
                // æ˜¾ç¤ºä¸»æ’­æ”¾å™¨ï¼Œéšè—ç¼©ç•¥å›¾
                video.style.display = 'block';
                if (thumbnail) {
                    thumbnail.style.display = 'none';
                }
                
                // éšè—æ’­æ”¾æŒ‰é’®é®ç½©
                overlay.classList.add('hidden');
                loadingIndicator.classList.add('show');
                
                // è®°å½•æ´»åŠ¨è§†é¢‘
                activeVideos.set(index, video);
                
                // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åœæ­¢å…¶ä»–è§†é¢‘
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
                
                // å°è¯•æ’­æ”¾
                const playPromise = video.play();
                
                if (playPromise !== undefined) {
                    await playPromise;
                    showNotification(`å¼€å§‹æ’­æ”¾: ${videoList[index].name || videoList[index].filename}`, 'success');
                }
                
            } catch (error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                
                // å¦‚æœæ˜¯è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼Œå°è¯•é™éŸ³æ’­æ”¾
                if (error.name === 'NotAllowedError') {
                    video.muted = true;
                    try {
                        await video.play();
                        showNotification('è§†é¢‘å·²é™éŸ³æ’­æ”¾ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼‰', 'error');
                    } catch (e) {
                        showNotification('è¯·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®', 'error');
                        resetVideo(index);
                    }
                } else {
                    showNotification('æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    resetVideo(index);
                }
            } finally {
                loadingIndicator.classList.remove('show');
            }
        }

        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayPause(index) {
            const video = document.getElementById(`video-${index}`);
            if (!video) return;

            if (video.paused) {
                if (video.style.display === 'none') {
                    playVideo(index);
                } else {
                    video.play();
                }
            } else {
                video.pause();
            }
        }

        // åœæ­¢å…¶ä»–è§†é¢‘
        function stopOtherVideos(currentIndex) {
            activeVideos.forEach((video, index) => {
                if (index !== currentIndex && !video.paused) {
                    video.pause();
                    resetVideo(index);
                }
            });
        }

        // åœæ­¢æ‰€æœ‰è§†é¢‘
        function stopAllVideos() {
            activeVideos.forEach((video, index) => {
                if (!video.paused) {
                    video.pause();
                }
                resetVideo(index);
            });
            activeVideos.clear();
            showNotification('å·²åœæ­¢æ‰€æœ‰è§†é¢‘', 'success');
        }

        // é‡ç½®è§†é¢‘
        function resetVideo(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (video) {
                video.currentTime = 0;
                video.style.display = 'none';
                video.preload = 'none';
            }
            
            // é‡æ–°æ˜¾ç¤ºç¼©ç•¥å›¾
            if (thumbnail && thumbnailsLoaded.has(index)) {
                thumbnail.style.display = 'block';
            }
            
            if (overlay) {
                overlay.classList.remove('hidden');
            }
            
            if (card) {
                card.classList.remove('playing');
            }
            
            updatePlayButton(index, false);
            activeVideos.delete(index);
        }

        // åˆ‡æ¢é™éŸ³
        function toggleMute(index) {
            const video = document.getElementById(`video-${index}`);
            if (!video) return;
            
            video.muted = !video.muted;
            showNotification(video.muted ? 'å·²é™éŸ³' : 'å·²å–æ¶ˆé™éŸ³', 'success');
        }

        // æ”¹å˜éŸ³é‡
        function changeVolume(index, value) {
            const video = document.getElementById(`video-${index}`);
            if (!video) return;
            
            video.volume = value / 100;
            if (video.muted && value > 0) {
                video.muted = false;
            }
        }

        // åˆ‡æ¢å…¨å±
        function toggleFullscreen(index) {
            const video = document.getElementById(`video-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (!video) return;

            // ç§»åŠ¨ç«¯ï¼šç›´æ¥è°ƒç”¨ç³»ç»ŸåŸç”Ÿæ’­æ”¾å™¨
            if (isMobile) {
                if (video.webkitEnterFullscreen) {
                    video.webkitEnterFullscreen();  // iOS Safari
                } else if (video.requestFullscreen) {
                    video.requestFullscreen();      // Android Chrome
                }
                return;
            }

            if (!document.fullscreenElement) {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                } else if (video.mozRequestFullScreen) {
                    video.mozRequestFullScreen();
                } else if (video.msRequestFullscreen) {
                    video.msRequestFullscreen();
                } else {
                    // å¤‡ç”¨å…¨å±æ–¹æ¡ˆ - ä½¿ç”¨å¡ç‰‡å…¨å±
                    card.classList.add('fullscreen');
                }
                showNotification('å·²è¿›å…¥å…¨å±æ¨¡å¼', 'success');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else {
                    card.classList.remove('fullscreen');
                }
                showNotification('å·²é€€å‡ºå…¨å±æ¨¡å¼', 'success');
            }
        }

        // ä¸‹è½½è§†é¢‘
        function downloadVideo(filename) {
            const link = document.createElement('a');
            link.href = `/api/download_video/${encodeURIComponent(filename)}`;
            link.download = filename;
            link.click();
            showNotification(`å¼€å§‹ä¸‹è½½: ${filename}`, 'success');
        }

        // é¢„åŠ è½½è§†é¢‘
        async function preloadVideos() {
            if (!settings.preload) return;
            
            showPreloadIndicator(true, 'æ­£åœ¨é¢„åŠ è½½è§†é¢‘...');
            
            // é¢„åŠ è½½å‰3ä¸ªè§†é¢‘
            const preloadCount = Math.min(3, videoList.length);
            
            for (let i = 0; i < preloadCount; i++) {
                try {
                    const response = await fetch(`/api/preload_chunk/${encodeURIComponent(videoList[i].filename)}?chunk_size=524288`);
                    
                    if (response.ok) {
                        await response.blob();
                        preloadedVideos.add(videoList[i].filename);
                        
                        // æ˜¾ç¤ºé¢„åŠ è½½æ ‡è®°
                        const badge = document.getElementById(`preload-${i}`);
                        if (badge) {
                            badge.style.display = 'flex';
                        }
                        
                        console.log(`âœ… é¢„åŠ è½½å®Œæˆ: ${videoList[i].filename}`);
                    }
                } catch (error) {
                    console.warn(`é¢„åŠ è½½å¤±è´¥: ${videoList[i].filename}`, error);
                }
            }
            
            showPreloadIndicator(false);
            
            if (preloadedVideos.size > 0) {
                showNotification(`å·²é¢„åŠ è½½ ${preloadedVideos.size} ä¸ªè§†é¢‘`, 'success');
            }
        }

        // åˆ·æ–°è§†é¢‘åˆ—è¡¨
        async function refreshVideoList() {
            showNotification('æ­£åœ¨åˆ·æ–°è§†é¢‘åˆ—è¡¨...', 'success');
            stopAllVideos();
            preloadedVideos.clear();
            thumbnailsLoaded.clear();
            await loadVideoList();
        }

        // æ›´æ–°æ’­æ”¾æŒ‰é’®çŠ¶æ€
        function updatePlayButton(index, isPlaying) {
            const btn = document.getElementById(`play-btn-${index}`);
            if (!btn) return;
            
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            if (isPlaying) {
                icon.className = 'fas fa-pause';
                if (text) text.textContent = 'æš‚åœ';
                btn.classList.add('active');
            } else {
                icon.className = 'fas fa-play';
                if (text) text.textContent = 'æ’­æ”¾';
                btn.classList.remove('active');
            }
        }



        // æ˜¾ç¤ºé¢„åŠ è½½æŒ‡ç¤ºå™¨
        function showPreloadIndicator(show, message = 'æ­£åœ¨é¢„åŠ è½½è§†é¢‘...') {
            const indicator = document.getElementById('preloadIndicator');
            const span = indicator.querySelector('span');
            
            if (show) {
                span.textContent = message;
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // ç”¨æˆ·äº¤äº’è·Ÿè¸ª
        function setupUserInteractionTracking() {
            const interactionEvents = ['click', 'touchstart', 'keydown'];
            
            function markUserInteraction() {
                userHasInteracted = true;
                interactionEvents.forEach(event => {
                    document.removeEventListener(event, markUserInteraction);
                });
                console.log('âœ… ç”¨æˆ·å·²äº¤äº’');
            }
            
            interactionEvents.forEach(event => {
                document.addEventListener(event, markUserInteraction, { once: true });
            });
        }

        // ç§»åŠ¨ç«¯ä¼˜åŒ–
        function setupMobileOptimizations() {
            if (isMobile) {
                // é˜²æ­¢åŒå‡»ç¼©æ”¾
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);

                // ä¼˜åŒ–è§†é¢‘æ’­æ”¾
                document.querySelectorAll('video').forEach(video => {
                    video.setAttribute('playsinline', 'true');
                    video.setAttribute('webkit-playsinline', 'true');
                    video.setAttribute('x5-video-player-type', 'h5');
                });
            }
        }

        // é”®ç›˜æ§åˆ¶
        function setupKeyboardControls() {
            if (!isMobile) {
                document.addEventListener('keydown', function(e) {
                    // ç©ºæ ¼é”®æš‚åœ/æ’­æ”¾å½“å‰è§†é¢‘
                    if (e.key === ' ') {
                        e.preventDefault();
                        const playingVideos = Array.from(activeVideos.keys());
                        if (playingVideos.length > 0) {
                            togglePlayPause(playingVideos[0]);
                        }
                    }
                    // ESCé”®åœæ­¢æ‰€æœ‰è§†é¢‘
                    else if (e.key === 'Escape') {
                        stopAllVideos();
                    }
                });
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-info-circle';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState() {
            const emptyState = document.getElementById('emptyState');
            const videoGrid = document.getElementById('videoGrid');
            
            emptyState.style.display = 'block';
            videoGrid.style.display = 'none';
        }

        // å·¥å…·å‡½æ•°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatDate(date) {
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // ç®€å•çš„å…³äºå’Œè”ç³»ä¿¡æ¯
        function showAbout() {
            showNotification('è§†é¢‘å±•ç¤ºå¹³å° - æä¾›é«˜è´¨é‡çš„è§†é¢‘å†…å®¹å±•ç¤º', 'success');
        }

        function showContact() {
            showNotification('å¦‚éœ€è”ç³»ï¼Œè¯·å‘é€é‚®ä»¶è‡³ contact@example.com', 'success');
        }

        // é¡µé¢å¯è§æ€§å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶æš‚åœæ‰€æœ‰è§†é¢‘
                activeVideos.forEach((video) => {
                    if (!video.paused) {
                        video.pause();
                    }
                });
            }
        });
    </script>
</body>
</html>