<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>凤凰眼视觉</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 基础样式 - 微信风格 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            background-image: 
                linear-gradient(to right, #4f4f4f2e 1px, transparent 1px),
                linear-gradient(to bottom, #4f4f4f2e 1px, transparent 1px);
            background-size: 14px 24px;
            color: #f9fafb; /* text-gray-100 */
            line-height: 1.5;
            font-size: 14px; /* text-sm */
            overflow-x: hidden;
            position: relative;
        }

        /* 添加渐变遮罩效果 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse 60% 50% at 50% 0%, #000 70%, transparent 110%);
            pointer-events: none;
            z-index: -1;
        }

        /* 导航栏 - 现代化深色设计 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #1f2937; /* bg-gray-800 */
            border-bottom: 1px solid #374151; /* border-gray-700 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(8px);
            height: 60px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px; /* text-lg */
            font-weight: 700;
            color: #f9fafb; /* text-white */
            text-decoration: none;
            transition: all 0.2s ease;
            line-height: 1.2;
            height: 100%;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .logo img {
            height: 60px;
            width: auto;
            object-fit: contain;
            filter: brightness(1.1);
            margin: 0;
            padding: 0;
            vertical-align: middle;
            display: block;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 24px;
        }

        .nav-links a {
            color: #d1d5db; /* text-gray-300 */
            text-decoration: none;
            font-size: 14px; /* text-sm */
            font-weight: 500; /* font-medium */
            line-height: 1.4;
            letter-spacing: 0.025em;
            padding: 10px 16px;
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #f9fafb; /* text-white */
            background-color: #374151; /* bg-gray-700 */
            transform: scale(1.05);
        }

        .nav-links a.active {
            color: #f9fafb; /* text-white */
            background-color: #0ea5e9; /* bg-sky-500 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        /* 主容器 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 150px 20px 20px;
        }

        /* 页面标题 */
        .page-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .page-header h1 {
            font-size: 36px; /* text-3xl */
            font-weight: 700;
            background: linear-gradient(135deg, #38bdf8, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 48px;
            line-height: 1.2;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .page-header p {
            color: #9ca3af; /* text-gray-400 */
            font-size: 16px; /* text-base */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        /* 预加载指示器 */
        .preload-indicator {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(14, 165, 233, 0.95); /* bg-sky-500 with opacity */
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1500;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(8px);
        }

        .preload-indicator.show {
            transform: translateY(0);
            opacity: 1;
        }

        .preload-indicator i {
            font-size: 12px;
            animation: spin 1s linear infinite;
        }

        /* 视频库头部 */
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
        }

        .library-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #f9fafb; /* text-white */
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: #374151; /* bg-gray-700 */
            color: #d1d5db; /* text-gray-300 */
            border: 1px solid #4b5563; /* border-gray-600 */
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px; /* text-sm */
            font-weight: 500; /* font-medium */
            line-height: 1.4;
            letter-spacing: 0.025em;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            gap: 6px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .action-btn:hover {
            background: #4b5563; /* bg-gray-600 */
            color: #f9fafb; /* text-white */
            transform: scale(1.05);
        }

        /* 设置按钮 */
        .settings-btn {
            background: #0ea5e9; /* bg-sky-500 */
            color: white;
            border: 1px solid #0ea5e9;
        }

        .settings-btn:hover {
            background: #0284c7; /* bg-sky-600 */
            color: white;
        }

        /* 设置面板 */
        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .settings-content {
            background: #1f2937; /* bg-gray-800 */
            border-radius: 16px;
            padding: 24px;
            margin: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #374151; /* ring-1 ring-gray-700 */
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }

        .settings-header h3 {
            font-size: 18px; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #f9fafb; /* text-white */
            line-height: 1.3;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 20px;
            color: #9ca3af; /* text-gray-400 */
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-settings:hover {
            background: #374151; /* bg-gray-700 */
            color: #f9fafb; /* text-white */
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: #f9fafb; /* text-white */
            font-weight: 500;
        }

        .setting-desc {
            font-size: 12px;
            color: #9ca3af; /* text-gray-400 */
            margin-top: 2px;
        }

        /* 开关按钮 */
        .switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #4b5563; /* bg-gray-600 */
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .switch.active {
            background: #0ea5e9; /* bg-sky-500 */
        }

        .switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .switch.active::before {
            transform: translateX(24px);
        }

        /* 视频网格 - 网页端一行一个视频 */
        .video-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 32px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        /* 视频卡片 - 包含播放器 */
        .video-card {
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(12px);
        }

        .video-card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: translateY(-4px);
            border-color: rgba(14, 165, 233, 0.5); /* ring-sky-500 with opacity */
        }

        .video-card.playing {
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.3); /* bg-sky-500 with opacity */
            border: 2px solid #0ea5e9; /* ring-sky-500 */
        }

        .video-card.ios-preparing {
            border: 2px solid #fbbf24; /* ring-amber-400 */
        }

        /* 视频播放器容器 */
        .video-player-container {
            position: relative;
            aspect-ratio: 21/9;
            background: #000;
            overflow: hidden;
        }

        /* 视频缩略图样式 */
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            pointer-events: none;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
            opacity: 0; /* 初始透明，加载完成后显示 */
        }

        .video-thumbnail.loaded {
            opacity: 1;
        }

        .video-thumbnail.loading {
            opacity: 0.7;
        }

        /* 主播放器样式 */
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: auto;
            cursor: pointer;
        }

        /* 缩略图加载占位符 */
        .thumbnail-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%); /* bg-gray-700 to bg-gray-800 */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af; /* text-gray-400 */
            font-size: 14px;
            z-index: 0;
        }

        .thumbnail-placeholder i {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
            color: #6b7280; /* text-gray-500 */
        }

        /* 播放按钮遮罩 - iOS优化版 */
        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 3;
        }

        .play-overlay:hover {
            background: rgba(0, 0, 0, 0.6);
        }

        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-overlay.ios-disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .play-button {
            width: 80px;
            height: 80px;
            background: rgba(14, 165, 233, 0.9); /* bg-sky-500 with opacity */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            box-shadow: 0 12px 40px rgba(14, 165, 233, 0.3);
        }

        .play-button:hover {
            transform: scale(1.1);
            background: #0ea5e9; /* bg-sky-500 */
            box-shadow: 0 12px 40px rgba(14, 165, 233, 0.4);
        }

        .play-button i {
            color: white;
            font-size: 32px;
            margin-left: 4px;
        }

        /* iOS提示文本 */
        .ios-hint {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
            z-index: 4;
            backdrop-filter: blur(8px);
        }

        .ios-hint.show {
            display: block;
        }

        /* 视频加载指示器 */
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            display: none;
            z-index: 0;
        }

        .video-loading.show {
            display: block;
        }

        /* 视频时长标签 */
        .duration-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(14, 165, 233, 0.9); /* bg-sky-500 with opacity */
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            z-index: 5;
            backdrop-filter: blur(8px);
        }

        /* 视频信息区域 */
        .video-info {
            padding: 24px;
            border-top: 1px solid rgba(55, 65, 81, 0.3); /* border-gray-700 with opacity */
        }

        .video-title {
            font-weight: 700;
            color: #f9fafb; /* text-white */
            margin-bottom: 12px;
            font-size: 16px; /* text-base */
            line-height: 1.4;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #9ca3af; /* text-gray-400 */
            font-size: 13px; /* text-sm */
            line-height: 1.4;
            letter-spacing: 0.025em;
        }

        /* 进度条样式 */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(75, 101, 115, 0.5); /* bg-gray-600 with opacity */
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #0ea5e9; /* bg-sky-500 */
            border-radius: 2px;
            transition: width 0.1s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #0ea5e9; /* bg-sky-500 */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.4);
        }

        /* 空状态和加载状态 */
        .loading-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af; /* text-gray-400 */
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(8px);
            font-size: 14px; /* text-sm */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        .loading-state i {
            font-size: 32px;
            animation: spin 1s linear infinite;
            margin-bottom: 12px;
            color: #0ea5e9; /* text-sky-500 */
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af; /* text-gray-400 */
            display: none;
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(8px);
            font-size: 14px; /* text-sm */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        .empty-state i {
            font-size: 48px;
            color: #6b7280; /* text-gray-500 */
            margin-bottom: 16px;
        }

        /* 通知样式 */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(31, 41, 55, 0.95); /* bg-gray-800 with opacity */
            color: #f9fafb; /* text-white */
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(55, 65, 81, 0.5); /* border-gray-700 with opacity */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1500;
            backdrop-filter: blur(8px);
            max-width: 300px;
            font-size: 14px; /* text-sm */
            line-height: 1.4;
            letter-spacing: 0.025em;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #0ea5e9; /* ring-sky-500 */
        }

        .notification.error {
            border-left: 4px solid #ef4444; /* ring-red-500 */
        }

        .notification i {
            margin-right: 8px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .nav-container {
                height: 60px;
            }

            .container {
                padding: 135px 16px 16px;
            }

            .logo img {
                height: 48px;
                margin: 0;
                padding: 0;
                vertical-align: middle;
                display: block;
            }

            .nav-links {
                display: none;
            }

            .video-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 0 8px;
                max-width: none;
            }

            .library-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .page-header h1 {
                font-size: clamp(22px, 6.5vw, 28px); /* 自适应字号，避免换行 */
                line-height: 1.2;
                letter-spacing: -0.025em;
                white-space: nowrap;          /* 禁止换行 */
                word-break: keep-all;         /* 中文尽量不拆分 */
                overflow: hidden;             /* 超出隐藏 */
                text-overflow: ellipsis;      /* 超出显示省略号 */
            }

            .page-header p {
                font-size: clamp(13px, 4.2vw, 16px); /* 自适应字号，避免换行 */
                line-height: 1.4;
                letter-spacing: 0.01em;
                white-space: nowrap;          /* 禁止换行 */
                word-break: keep-all;         /* 中文尽量不拆分 */
                overflow: hidden;             /* 超出隐藏 */
                text-overflow: ellipsis;      /* 超出显示省略号 */
            }

            .video-player-container {
                aspect-ratio: 16/9;
            }

            .play-button {
                width: 50px;
                height: 50px;
            }

            .play-button i {
                font-size: 20px;
            }

            .notification {
                right: 16px;
                left: 16px;
                min-width: auto;
                max-width: none;
                text-align: center;
            }

            .preload-indicator {
                left: 16px;
                font-size: 11px;
                padding: 6px 10px;
            }

            .settings-content {
                margin: 10px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .video-info {
                padding: 12px;
            }

            .video-title {
                font-size: 13px; /* text-sm */
                line-height: 1.4;
                letter-spacing: -0.025em;
            }

            .video-meta {
                font-size: 11px; /* text-xs */
                line-height: 1.4;
                letter-spacing: 0.025em;
            }
        }

        /* 全屏样式 */
        .video-card.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            border-radius: 0;
            width: 100%;
            height: 100%;
        }

        .video-card.fullscreen .video-player-container {
            height: calc(100% - 120px);
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #374151; /* bg-gray-700 */
        }

        ::-webkit-scrollbar-thumb {
            background: #6b7280; /* bg-gray-500 */
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* bg-gray-400 */
        }

        /* 动画 */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 缩略图淡入动画 */
        @keyframes thumbnailFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-thumbnail.fade-in {
            animation: thumbnailFadeIn 0.5s ease-in-out;
        }

        /* 防止移动端页面缩放 */
        html {
            touch-action: pan-x pan-y;
            -webkit-text-size-adjust: none;
            -ms-text-size-adjust: none;
        }

        /* 移动端安全区域适配 */
        @supports (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: env(safe-area-inset-top);
                height: calc(60px + env(safe-area-inset-top));
            }

            .container {
                padding-top: calc(135px + env(safe-area-inset-top));
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header class="header" id="header">
        <div class="nav-container">
            <a href="#" class="logo">
                <img src="/static/logo/logo1.png">
            </a>
        </div>
    </header>

    <!-- 预加载指示器 -->
    <div class="preload-indicator" id="preloadIndicator">
        <i class="fas fa-spinner"></i>
        <span>正在预加载视频...</span>
    </div>

    <!-- 主容器 -->
    <div class="container">
        <!-- 页面标题 -->
        <div class="page-header">
            <h1>凤凰眼视觉高维智能观赛</h1>
            <p>沉浸体验竞技精彩时刻，享受高维视觉盛宴</p>
        </div>

        <!-- 加载状态 -->
        <div class="loading-state" id="loading">
            <i class="fas fa-spinner"></i>
            <p>正在加载视频列表...</p>
        </div>

        <!-- 视频网格 -->
        <div class="video-grid" id="videoGrid">
            <!-- 视频列表将通过JavaScript动态加载 -->
        </div>

        <!-- 空状态 -->
        <div class="empty-state" id="emptyState">
            <i class="fas fa-video-slash"></i>
            <h3>暂无视频内容</h3>
            <p>请添加视频文件到服务器</p>
        </div>
    </div>

    <!-- 设置面板 -->
    <div class="settings-panel" id="settingsPanel" onclick="hideSettings(event)">
        <div class="settings-content" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h3>播放设置</h3>
                <button class="close-settings" onclick="hideSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">自动停止其他视频</div>
                    <div class="setting-desc">播放新视频时自动停止其他正在播放的视频</div>
                </div>
                <div class="switch active" id="autoStopSwitch" onclick="toggleAutoStop()">
                </div>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">预加载视频</div>
                    <div class="setting-desc">预先加载部分视频以提高播放流畅度</div>
                </div>
                <div class="switch active" id="preloadSwitch" onclick="togglePreload()">
                </div>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">自动加载封面</div>
                    <div class="setting-desc">页面加载时自动显示视频封面</div>
                </div>
                <div class="switch active" id="thumbnailSwitch" onclick="toggleThumbnail()">
                </div>
            </div>
        </div>
    </div>

    <!-- 通知组件 -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">操作成功</span>
    </div>

    <script>
        // 全局变量
        let videoList = [];
        let activeVideos = new Map(); // 存储活动的视频播放器
        let preloadedVideos = new Set();
        let thumbnailsLoaded = new Set();
        let iosVideoStates = new Map(); // iOS设备上的视频状态管理
        
        // 改进移动端和iOS检测
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        let isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        
        let userHasInteracted = false;

        // 用户设置
        let settings = {
            autoStop: true,       // 自动停止其他视频
            preload: true,        // 预加载视频
            thumbnail: true       // 自动加载封面
        };

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 开始加载视频列表...');
            console.log('设备信息:', { isMobile, isIOS, isSafari });
            loadSettings();
            loadVideoList();
            setupUserInteractionTracking();
            setupMobileOptimizations();
            setupKeyboardControls();
            
            // iOS特殊初始化
            if (isIOS) {
                setupIOSOptimizations();
            }
        });

        // iOS专用优化设置
        function setupIOSOptimizations() {
            console.log('🍎 设置iOS专用优化...');
            
            // 添加iOS特殊的viewport meta标签
            const viewportMeta = document.querySelector('meta[name="viewport"]');
            if (viewportMeta) {
                viewportMeta.content += ', user-scalable=no';
            }
            
            // 禁用iOS特殊手势
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            document.addEventListener('gesturechange', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            document.addEventListener('gestureend', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
        }

        // 加载用户设置
        function loadSettings() {
            updateSettingsUI();
        }

        // 更新设置界面
        function updateSettingsUI() {
            document.getElementById('autoStopSwitch').classList.toggle('active', settings.autoStop);
            document.getElementById('preloadSwitch').classList.toggle('active', settings.preload);
            document.getElementById('thumbnailSwitch').classList.toggle('active', settings.thumbnail);
        }

        // 显示设置面板
        function showSettings() {
            document.getElementById('settingsPanel').style.display = 'flex';
            updateSettingsUI();
        }

        // 隐藏设置面板
        function hideSettings(event) {
            if (!event || event.target.id === 'settingsPanel') {
                document.getElementById('settingsPanel').style.display = 'none';
            }
        }

        // 切换自动停止设置
        function toggleAutoStop() {
            settings.autoStop = !settings.autoStop;
            updateSettingsUI();
            showNotification(
                settings.autoStop ? '已启用自动停止其他视频' : '已禁用自动停止其他视频', 
                'success'
            );
        }

        // 切换预加载设置
        function togglePreload() {
            settings.preload = !settings.preload;
            updateSettingsUI();
            showNotification(
                settings.preload ? '已启用视频预加载' : '已禁用视频预加载', 
                'success'
            );
        }

        // 切换封面设置
        function toggleThumbnail() {
            settings.thumbnail = !settings.thumbnail;
            updateSettingsUI();
            showNotification(
                settings.thumbnail ? '已启用自动加载封面' : '已禁用自动加载封面', 
                'success'
            );
            
            if (settings.thumbnail && videoList.length > 0) {
                loadThumbnails();
            }
        }

        // 加载视频列表
        async function loadVideoList() {
            try {
                showLoading(true);
                showPreloadIndicator(true, '正在获取视频列表...');
                
                const response = await fetch('/api/get_video_list');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    videoList = data.videos || [];
                    
                    if (videoList.length > 0) {
                        renderVideoGrid();
                        
                        // 根据设置决定是否预加载
                        if (settings.preload) {
                            preloadVideos();
                        }

                        // 根据设置决定是否加载封面
                        if (settings.thumbnail) {
                            loadThumbnails();
                        }
                    } else {
                        showEmptyState();
                    }
                } else {
                    throw new Error(data.message || '获取视频列表失败');
                }
                
            } catch (error) {
                console.error('加载视频列表失败:', error);
                showNotification('加载失败，请刷新重试', 'error');
                showEmptyState();
            } finally {
                showLoading(false);
                showPreloadIndicator(false);
            }
        }

        // 渲染视频网格
        function renderVideoGrid() {
            const videoGrid = document.getElementById('videoGrid');
            const emptyState = document.getElementById('emptyState');
            
            emptyState.style.display = 'none';
            videoGrid.innerHTML = '';
            videoGrid.style.display = 'grid';

            videoList.forEach((video, index) => {
                const card = createVideoCard(video, index);
                videoGrid.appendChild(card);
            });
        }

        // 创建视频卡片（修复缩略图加载）
        function createVideoCard(video, index) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `video-card-${index}`;
            card.setAttribute('data-index', index);
            card.setAttribute('data-filename', video.filename);

            const sizeText = video.size ? formatFileSize(video.size) : '未知大小';
            const modifiedText = video.modified ? formatDate(new Date(video.modified)) : '未知日期';

            card.innerHTML = `
                <div class="video-player-container" id="player-container-${index}">
                    <!-- 缩略图占位符 -->
                    <div class="thumbnail-placeholder" id="placeholder-${index}">
                        <div style="text-align: center;">
                            <i class="fas fa-video"></i>
                        </div>
                    </div>
                    
                    <!-- 静态封面图片 - 修复加载问题 -->
                    <img 
                        id="thumbnail-${index}" 
                        class="video-thumbnail"
                        alt="视频封面"
                        crossorigin="anonymous"
                        loading="eager" />
                    
                    <!-- 主播放器 - iOS优化版 -->
                    <video 
                        id="video-${index}" 
                        class="video-player"
                        preload="none"
                        playsinline 
                        webkit-playsinline
                        x5-video-player-type="h5"
                        x5-video-player-fullscreen="true"
                        x5-video-orientation="portrait"
                        style="display: none;"
                        ${isMobile ? 'controls' : ''}
                        muted="${isIOS}">
                        <source src="/api/stream_video/${encodeURIComponent(video.filename)}" type="video/mp4">
                        您的浏览器不支持视频播放。
                    </video>
                    
                    <div class="play-overlay" id="overlay-${index}">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    
                    <div class="video-loading" id="loading-${index}">
                        <i class="fas fa-spinner"></i>
                    </div>
                    
                    <!-- iOS提示文本 -->
                    ${isIOS ? `<div class="ios-hint" id="hint-${index}">准备播放中，请稍候...</div>` : ''}
                </div>
                
                <div class="video-info">
                    <div class="video-title" title="${video.filename}">
                        ${video.name || video.filename}
                    </div>
                    <div class="video-meta">
                        <span><i class="fas fa-file"></i> ${sizeText}</span>
                        <span><i class="fas fa-calendar"></i> ${modifiedText}</span>
                    </div>
                </div>
            `;

            // 设置视频事件监听
            setTimeout(() => {
                setupVideoEvents(index);
            }, 0);

            return card;
        }

        // 修复视频事件设置
        function setupVideoEvents(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const container = document.getElementById(`player-container-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            
            if (!video) return;

            // 初始化iOS视频状态
            if (isIOS) {
                iosVideoStates.set(index, {
                    isReady: false,
                    isLoading: false,
                    hasUserInteracted: false
                });
            }

            // iOS优化的播放按钮事件处理
            if (overlay) {
                overlay.onclick = null; // 移除内联事件
                
                const playHandler = async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // iOS设备特殊处理
                    if (isIOS) {
                        await handleIOSVideoPlay(index);
                    } else {
                        await playVideo(index);
                    }
                };
                
                // 添加多种事件确保iOS兼容
                overlay.addEventListener('click', playHandler, { passive: false });
                overlay.addEventListener('touchend', playHandler, { passive: false });
                
                // 防止iOS双击缩放
                overlay.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                }, { passive: false });
            }

            // 修复缩略图加载事件
            if (thumbnail) {
                const onLoad = () => {
                    if (thumbnailsLoaded.has(index)) return;
                    console.log(`✅ 缩略图加载成功: ${index}`);
                    showThumbnail(index);
                    thumbnailsLoaded.add(index);
                };
                
                const onError = (e) => {
                    console.error(`❌ 缩略图加载失败: ${index}`, e);
                    showThumbnailError(index);
                };
                
                thumbnail.addEventListener('load', onLoad, { once: true });
                thumbnail.addEventListener('error', onError, { once: true });
            }

            // 视频播放器事件监听 - iOS优化版
            video.addEventListener('loadstart', () => {
                console.log(`📱 视频 ${index} 开始加载 (iOS: ${isIOS})`);
                showLoadingIndicator(index, true);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = true;
                        iosVideoStates.set(index, state);
                    }
                }
            });

            video.addEventListener('loadedmetadata', () => {
                console.log(`📱 视频 ${index} 元数据已加载`);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isReady = true;
                        iosVideoStates.set(index, state);
                    }
                    // iOS设备上确保控件显示
                    video.controls = true;
                    hideIOSHint(index);
                }
            });

            video.addEventListener('canplay', () => {
                console.log(`📱 视频 ${index} 可以播放`);
                showLoadingIndicator(index, false);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = false;
                        iosVideoStates.set(index, state);
                    }
                    hideIOSHint(index);
                }
            });

            video.addEventListener('play', () => {
                console.log(`📱 视频 ${index} 开始播放`);
                const card = document.getElementById(`video-card-${index}`);
                if (card) {
                    card.classList.add('playing');
                    card.classList.remove('ios-preparing');
                }
                
                // 根据设置决定是否停止其他视频
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
            });

            video.addEventListener('pause', () => {
                console.log(`📱 视频 ${index} 暂停`);
                const card = document.getElementById(`video-card-${index}`);
                if (card) {
                    card.classList.remove('playing');
                }
            });

            video.addEventListener('ended', () => {
                console.log(`📱 视频 ${index} 播放结束`);
                resetVideo(index);
                showNotification('视频播放完成', 'success');
            });

            // iOS优化的错误处理
            video.addEventListener('error', (e) => {
                console.error(`📱 视频 ${index} 加载失败:`, e);
                console.error('错误详情:', video.error);
                showLoadingIndicator(index, false);
                
                if (isIOS) {
                    hideIOSHint(index);
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = false;
                        state.isReady = false;
                        iosVideoStates.set(index, state);
                    }
                }
                
                let errorMsg = '视频加载失败';
                if (video.error) {
                    switch(video.error.code) {
                        case 1: errorMsg = '视频加载被中止'; break;
                        case 2: errorMsg = isIOS ? 'iOS网络错误，建议使用HTTPS' : '网络错误，请检查连接'; break;
                        case 3: errorMsg = '视频解码失败'; break;
                        case 4: errorMsg = '视频格式不支持'; break;
                    }
                }
                showNotification(errorMsg, 'error');
            });

            // iOS特殊的等待和缓冲事件
            video.addEventListener('waiting', () => {
                console.log(`📱 视频 ${index} 缓冲中...`);
                showLoadingIndicator(index, true);
                if (isIOS) {
                    showIOSHint(index, '缓冲中，请稍候...');
                }
            });

            video.addEventListener('canplaythrough', () => {
                console.log(`📱 视频 ${index} 可流畅播放`);
                showLoadingIndicator(index, false);
                if (isIOS) {
                    hideIOSHint(index);
                }
            });
        }

        // iOS专用的视频播放处理
        async function handleIOSVideoPlay(index) {
            console.log(`🍎 iOS设备播放视频: ${index}`);
            
            const video = document.getElementById(`video-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (!video) return;
            
            try {
                // 显示准备状态
                card.classList.add('ios-preparing');
                showIOSHint(index, '正在准备播放...');
                
                // 禁用播放按钮防止重复点击
                overlay.classList.add('ios-disabled');
                
                // 显示视频元素并开始加载
                await showVideoPlayer(index);
                
                // 记录活动视频
                activeVideos.set(index, video);
                
                // 根据设置停止其他视频
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
                
                // 直接尝试播放，不等待复杂的状态
                console.log('🍎 开始iOS视频播放...');
                showIOSHint(index, '开始播放...');
                
                // iOS设备可能需要先加载再播放
                const playPromise = video.play();
                if (playPromise) {
                    await playPromise;
                }
                
                console.log(`🍎 iOS视频 ${index} 播放成功`);
                hideIOSHint(index);
                
            } catch (error) {
                console.error(`🍎 iOS播放失败: ${index}`, error);
                
                // 错误处理
                if (error.name === 'NotAllowedError') {
                    showIOSHint(index, '请点击视频播放按钮');
                    showNotification('iOS需要用户手动播放', 'error');
                } else {
                    showIOSHint(index, '播放失败，请重试');
                    showNotification('iOS播放失败，请重试', 'error');
                    resetVideo(index);
                }
            } finally {
                // 恢复播放按钮
                overlay.classList.remove('ios-disabled');
                card.classList.remove('ios-preparing');
            }
        }

        // 标准播放视频函数（非iOS）
        async function playVideo(index) {
            const video = document.getElementById(`video-${index}`);
            
            if (!video) {
                console.error(`视频元素未找到: video-${index}`);
                return;
            }

            console.log(`播放视频 ${index}`);

            try {
                // 显示视频播放器
                await showVideoPlayer(index);
                
                // 记录活动视频
                activeVideos.set(index, video);
                
                // 根据设置决定是否停止其他视频
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
                
                // 开始播放
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    await playPromise;
                    console.log(`✅ 视频 ${index} 播放成功`);
                    
                    // 播放成功后显示控件（非移动端）
                    if (!isMobile) {
                        video.controls = true;
                    }
                }
                
            } catch (error) {
                console.error(`播放失败: ${index}`, error);
                
                if (error.name === 'NotAllowedError') {
                    console.log('尝试静音播放...');
                    video.muted = true;
                    try {
                        await video.play();
                        video.controls = true;
                        showNotification('视频已静音播放（浏览器限制）', 'error');
                        console.log(`✅ 视频 ${index} 静音播放成功`);
                    } catch (e) {
                        console.error('静音播放也失败:', e);
                        showNotification('请手动点击播放按钮', 'error');
                        resetVideo(index);
                    }
                } else {
                    showNotification('播放失败，请重试', 'error');
                    resetVideo(index);
                }
            }
        }

        // 显示视频播放器的通用函数
        async function showVideoPlayer(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const loadingIndicator = document.getElementById(`loading-${index}`);
            
            // 显示加载状态
            showLoadingIndicator(index, true);
            overlay.classList.add('hidden');
            
            // 显示主播放器，隐藏缩略图
            video.style.display = 'block';
            if (thumbnail) {
                thumbnail.style.display = 'none';
            }
            
            // iOS设备需要显式开始加载视频数据
            if (isIOS) {
                video.preload = 'metadata';
                video.load(); // 显式加载视频元数据
                console.log(`🍎 iOS设备开始加载视频元数据: ${index}`);
            }
        }

        // 显示iOS提示
        function showIOSHint(index, message) {
            const hint = document.getElementById(`hint-${index}`);
            if (hint) {
                hint.textContent = message;
                hint.classList.add('show');
            }
        }

        // 隐藏iOS提示
        function hideIOSHint(index) {
            const hint = document.getElementById(`hint-${index}`);
            if (hint) {
                hint.classList.remove('show');
            }
        }

        // 显示缩略图
        function showThumbnail(index) {
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const placeholder = document.getElementById(`placeholder-${index}`);
            
            if (thumbnail && placeholder) {
                placeholder.style.display = 'none';
                thumbnail.style.display = 'block';
                thumbnail.classList.add('loaded', 'fade-in');
                console.log(`✅ 缩略图显示成功: ${index}`);
            }
        }

        // 改进缩略图错误显示
        function showThumbnailError(index) {
            const placeholder = document.getElementById(`placeholder-${index}`);
            
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="text-align: center; color: #9ca3af;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>封面加载失败</div>
                        ${isIOS ? '<div style="font-size: 12px; margin-top: 4px;">iOS设备可能需要HTTPS</div>' : ''}
                    </div>
                `;
            }
        }

        // 修复缩略图加载函数 - 统一处理所有设备
        function loadThumbnails() {
            if (!settings.thumbnail) return;
            
            console.log('🖼️ 开始统一加载缩略图，设备信息:', { isIOS, isSafari, isMobile });
            showPreloadIndicator(true, '正在加载视频封面...');
            
            let loadedCount = 0;
            const totalCount = videoList.length;
            
            videoList.forEach((video, index) => {
                const thumbnail = document.getElementById(`thumbnail-${index}`);
                if (thumbnail && !thumbnailsLoaded.has(index)) {
                    const checkLoaded = () => {
                        loadedCount++;
                        console.log(`缩略图加载进度: ${loadedCount}/${totalCount}`);
                        if (loadedCount >= totalCount) {
                            showPreloadIndicator(false);
                            console.log('所有缩略图加载完成');
                        }
                    };
                    
                    thumbnail.addEventListener('load', checkLoaded, { once: true });
                    thumbnail.addEventListener('error', checkLoaded, { once: true });
                    
                    // 所有设备统一设置 - 确保强制加载
                    thumbnail.loading = 'eager';
                    const imageUrl = `/api/video_cover/${encodeURIComponent(video.filename)}`;
                    
                    // 添加时间戳防止缓存问题
                    const cacheBustUrl = imageUrl + (imageUrl.includes('?') ? '&' : '?') + 't=' + Date.now();
                    
                    // 设置src触发加载
                    thumbnail.src = cacheBustUrl;
                    console.log(`🖼️ 设置缩略图URL: ${index} -> ${cacheBustUrl}`);
                }
            });
            
            // 超时处理
            setTimeout(() => {
                if (loadedCount < totalCount) {
                    showPreloadIndicator(false);
                    console.log(`缩略图加载超时，已加载: ${loadedCount}/${totalCount}`);
                }
            }, 15000);
        }

        // 停止其他视频
        function stopOtherVideos(currentIndex) {
            activeVideos.forEach((video, index) => {
                if (index !== currentIndex && !video.paused) {
                    video.pause();
                    resetVideo(index);
                }
            });
        }

        // 停止所有视频
        function stopAllVideos() {
            activeVideos.forEach((video, index) => {
                if (!video.paused) {
                    video.pause();
                }
                resetVideo(index);
            });
            activeVideos.clear();
            showNotification('已停止所有视频', 'success');
        }

        // 重置视频
        function resetVideo(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (video) {
                video.currentTime = 0;
                video.style.display = 'none';
                video.preload = 'none';
                if (!isMobile) {
                    video.controls = false;
                }
            }
            
            // 重新显示缩略图
            if (thumbnail && thumbnailsLoaded.has(index)) {
                thumbnail.style.display = 'block';
            }
            
            if (overlay) {
                overlay.classList.remove('hidden', 'ios-disabled');
            }
            
            if (card) {
                card.classList.remove('playing', 'ios-preparing');
            }
            
            // 隐藏iOS提示
            if (isIOS) {
                hideIOSHint(index);
                // 重置iOS状态
                const state = iosVideoStates.get(index);
                if (state) {
                    state.hasUserInteracted = false;
                    iosVideoStates.set(index, state);
                }
            }
            
            activeVideos.delete(index);
        }

        // 预加载视频
        async function preloadVideos() {
            if (!settings.preload) return;
            
            console.log('开始预加载视频，设备:', { isIOS, isSafari });
            showPreloadIndicator(true, '正在预加载视频...');
            
            // iOS设备减少预加载数量
            const preloadCount = Math.min(isIOS ? 1 : 2, videoList.length);
            
            for (let i = 0; i < preloadCount; i++) {
                try {
                    const chunkSize = isIOS ? 131072 : 262144; // iOS用更小的块
                    const response = await fetch(`/api/preload_chunk/${encodeURIComponent(videoList[i].filename)}?chunk_size=${chunkSize}`);
                    
                    if (response.ok) {
                        await response.blob();
                        preloadedVideos.add(videoList[i].filename);
                        console.log(`✅ 预加载完成: ${videoList[i].filename}`);
                    }
                } catch (error) {
                    console.warn(`预加载失败: ${videoList[i].filename}`, error);
                }
            }
            
            showPreloadIndicator(false);
        }

        // 刷新视频列表
        async function refreshVideoList() {
            showNotification('正在刷新视频列表...', 'success');
            stopAllVideos();
            preloadedVideos.clear();
            thumbnailsLoaded.clear();
            if (isIOS) {
                iosVideoStates.clear();
            }
            await loadVideoList();
        }

        // 显示预加载指示器
        function showPreloadIndicator(show, message = '正在预加载视频...') {
            const indicator = document.getElementById('preloadIndicator');
            const span = indicator.querySelector('span');
            
            if (show) {
                span.textContent = message;
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // 改进用户交互跟踪
        function setupUserInteractionTracking() {
            const interactionEvents = ['click', 'touchstart', 'touchend', 'keydown'];
            
            function markUserInteraction() {
                userHasInteracted = true;
                console.log('✅ 用户已交互, 设备:', { isIOS, isSafari });
                interactionEvents.forEach(event => {
                    document.removeEventListener(event, markUserInteraction);
                });
            }
            
            interactionEvents.forEach(event => {
                document.addEventListener(event, markUserInteraction, { 
                    once: true,
                    passive: event.includes('touch')
                });
            });
        }

        // 改进移动端优化
        function setupMobileOptimizations() {
            console.log('设置移动端优化，设备信息:', { isMobile, isIOS, isSafari });
            
            if (isMobile) {
                // 防止双击缩放
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, { passive: false });

                // iOS特殊优化
                if (isIOS) {
                    // 添加iOS特定的meta标签
                    if (!document.querySelector('meta[name="format-detection"]')) {
                        const meta = document.createElement('meta');
                        meta.name = 'format-detection';
                        meta.content = 'telephone=no';
                        document.head.appendChild(meta);
                    }
                }

                // 优化视频播放属性
                setTimeout(() => {
                    document.querySelectorAll('video').forEach(video => {
                        video.setAttribute('playsinline', 'true');
                        video.setAttribute('webkit-playsinline', 'true');
                        video.setAttribute('x5-video-player-type', 'h5');
                        
                        if (isIOS) {
                            video.setAttribute('x5-video-player-fullscreen', 'true');
                            video.setAttribute('x5-video-orientation', 'portrait');
                        }
                    });
                }, 1000);
            }
        }

        // 键盘控制
        function setupKeyboardControls() {
            if (!isMobile) {
                document.addEventListener('keydown', function(e) {
                    if (e.key === ' ') {
                        e.preventDefault();
                        const playingVideos = Array.from(activeVideos.keys());
                        if (playingVideos.length > 0) {
                            const video = activeVideos.get(playingVideos[0]);
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                        }
                    }
                    else if (e.key === 'Escape') {
                        stopAllVideos();
                    }
                });
            }
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-info-circle';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 显示/隐藏加载状态
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }

        // 改进加载指示器
        function showLoadingIndicator(index, show) {
            const loadingIndicator = document.getElementById(`loading-${index}`);
            if (loadingIndicator) {
                if (show) {
                    loadingIndicator.classList.add('show');
                } else {
                    loadingIndicator.classList.remove('show');
                }
            }
        }

        // 显示空状态
        function showEmptyState() {
            const emptyState = document.getElementById('emptyState');
            const videoGrid = document.getElementById('videoGrid');
            
            emptyState.style.display = 'block';
            videoGrid.style.display = 'none';
        }

        // 工具函数
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatDate(date) {
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // 页面可见性处理
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                activeVideos.forEach((video) => {
                    if (!video.paused) {
                        video.pause();
                    }
                });
            }
        });

        // 页面卸载时的清理
        window.addEventListener('beforeunload', function() {
            activeVideos.forEach((video) => {
                video.pause();
                video.currentTime = 0;
                video.src = '';
                video.load();
            });
        });
    </script>
</body>
</html>