<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡¤å‡°çœ¼è§†è§‰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¡€æ ·å¼ - å¾®ä¿¡é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            background-image: 
                linear-gradient(to right, #4f4f4f2e 1px, transparent 1px),
                linear-gradient(to bottom, #4f4f4f2e 1px, transparent 1px);
            background-size: 14px 24px;
            color: #f9fafb; /* text-gray-100 */
            line-height: 1.5;
            font-size: 14px; /* text-sm */
            overflow-x: hidden;
            position: relative;
        }

        /* æ·»åŠ æ¸å˜é®ç½©æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse 60% 50% at 50% 0%, #000 70%, transparent 110%);
            pointer-events: none;
            z-index: -1;
        }

        /* å¯¼èˆªæ  - ç°ä»£åŒ–æ·±è‰²è®¾è®¡ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #1f2937; /* bg-gray-800 */
            border-bottom: 1px solid #374151; /* border-gray-700 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(8px);
            height: 60px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px; /* text-lg */
            font-weight: 700;
            color: #f9fafb; /* text-white */
            text-decoration: none;
            transition: all 0.2s ease;
            line-height: 1.2;
            height: 100%;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .logo img {
            height: 60px;
            width: auto;
            object-fit: contain;
            filter: brightness(1.1);
            margin: 0;
            padding: 0;
            vertical-align: middle;
            display: block;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 24px;
        }

        .nav-links a {
            color: #d1d5db; /* text-gray-300 */
            text-decoration: none;
            font-size: 14px; /* text-sm */
            font-weight: 500; /* font-medium */
            line-height: 1.4;
            letter-spacing: 0.025em;
            padding: 10px 16px;
            border-radius: 8px;
            transition: all 0.15s ease-in-out;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #f9fafb; /* text-white */
            background-color: #374151; /* bg-gray-700 */
            transform: scale(1.05);
        }

        .nav-links a.active {
            color: #f9fafb; /* text-white */
            background-color: #0ea5e9; /* bg-sky-500 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 150px 20px 20px;
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .page-header h1 {
            font-size: 36px; /* text-3xl */
            font-weight: 700;
            background: linear-gradient(135deg, #38bdf8, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 48px;
            line-height: 1.2;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .page-header p {
            color: #9ca3af; /* text-gray-400 */
            font-size: 16px; /* text-base */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        /* é¢„åŠ è½½æŒ‡ç¤ºå™¨ */
        .preload-indicator {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(14, 165, 233, 0.95); /* bg-sky-500 with opacity */
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1500;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(8px);
        }

        .preload-indicator.show {
            transform: translateY(0);
            opacity: 1;
        }

        .preload-indicator i {
            font-size: 12px;
            animation: spin 1s linear infinite;
        }

        /* è§†é¢‘åº“å¤´éƒ¨ */
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
        }

        .library-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #f9fafb; /* text-white */
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: #374151; /* bg-gray-700 */
            color: #d1d5db; /* text-gray-300 */
            border: 1px solid #4b5563; /* border-gray-600 */
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px; /* text-sm */
            font-weight: 500; /* font-medium */
            line-height: 1.4;
            letter-spacing: 0.025em;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            gap: 6px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .action-btn:hover {
            background: #4b5563; /* bg-gray-600 */
            color: #f9fafb; /* text-white */
            transform: scale(1.05);
        }

        /* è®¾ç½®æŒ‰é’® */
        .settings-btn {
            background: #0ea5e9; /* bg-sky-500 */
            color: white;
            border: 1px solid #0ea5e9;
        }

        .settings-btn:hover {
            background: #0284c7; /* bg-sky-600 */
            color: white;
        }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .settings-content {
            background: #1f2937; /* bg-gray-800 */
            border-radius: 16px;
            padding: 24px;
            margin: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #374151; /* ring-1 ring-gray-700 */
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }

        .settings-header h3 {
            font-size: 18px; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #f9fafb; /* text-white */
            line-height: 1.3;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 20px;
            color: #9ca3af; /* text-gray-400 */
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-settings:hover {
            background: #374151; /* bg-gray-700 */
            color: #f9fafb; /* text-white */
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: #f9fafb; /* text-white */
            font-weight: 500;
        }

        .setting-desc {
            font-size: 12px;
            color: #9ca3af; /* text-gray-400 */
            margin-top: 2px;
        }

        /* å¼€å…³æŒ‰é’® */
        .switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #4b5563; /* bg-gray-600 */
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .switch.active {
            background: #0ea5e9; /* bg-sky-500 */
        }

        .switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .switch.active::before {
            transform: translateX(24px);
        }

        /* è§†é¢‘ç½‘æ ¼ - ç½‘é¡µç«¯ä¸€è¡Œä¸€ä¸ªè§†é¢‘ */
        .video-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 32px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        /* è§†é¢‘å¡ç‰‡ - åŒ…å«æ’­æ”¾å™¨ */
        .video-card {
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(12px);
        }

        .video-card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: translateY(-4px);
            border-color: rgba(14, 165, 233, 0.5); /* ring-sky-500 with opacity */
        }

        .video-card.playing {
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.3); /* bg-sky-500 with opacity */
            border: 2px solid #0ea5e9; /* ring-sky-500 */
        }

        .video-card.ios-preparing {
            border: 2px solid #fbbf24; /* ring-amber-400 */
        }

        /* è§†é¢‘æ’­æ”¾å™¨å®¹å™¨ */
        .video-player-container {
            position: relative;
            aspect-ratio: 21/9;
            background: #000;
            overflow: hidden;
        }

        /* è§†é¢‘ç¼©ç•¥å›¾æ ·å¼ */
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            pointer-events: none;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
            opacity: 0; /* åˆå§‹é€æ˜ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
        }

        .video-thumbnail.loaded {
            opacity: 1;
        }

        .video-thumbnail.loading {
            opacity: 0.7;
        }

        /* ä¸»æ’­æ”¾å™¨æ ·å¼ */
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: auto;
            cursor: pointer;
        }

        /* ç¼©ç•¥å›¾åŠ è½½å ä½ç¬¦ */
        .thumbnail-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%); /* bg-gray-700 to bg-gray-800 */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af; /* text-gray-400 */
            font-size: 14px;
            z-index: 0;
        }

        .thumbnail-placeholder i {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
            color: #6b7280; /* text-gray-500 */
        }

        /* æ’­æ”¾æŒ‰é’®é®ç½© - iOSä¼˜åŒ–ç‰ˆ */
        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 3;
        }

        .play-overlay:hover {
            background: rgba(0, 0, 0, 0.6);
        }

        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-overlay.ios-disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .play-button {
            width: 80px;
            height: 80px;
            background: rgba(14, 165, 233, 0.9); /* bg-sky-500 with opacity */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            box-shadow: 0 12px 40px rgba(14, 165, 233, 0.3);
        }

        .play-button:hover {
            transform: scale(1.1);
            background: #0ea5e9; /* bg-sky-500 */
            box-shadow: 0 12px 40px rgba(14, 165, 233, 0.4);
        }

        .play-button i {
            color: white;
            font-size: 32px;
            margin-left: 4px;
        }

        /* iOSæç¤ºæ–‡æœ¬ */
        .ios-hint {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
            z-index: 4;
            backdrop-filter: blur(8px);
        }

        .ios-hint.show {
            display: block;
        }

        /* è§†é¢‘åŠ è½½æŒ‡ç¤ºå™¨ */
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            display: none;
            z-index: 0;
        }

        .video-loading.show {
            display: block;
        }

        /* è§†é¢‘æ—¶é•¿æ ‡ç­¾ */
        .duration-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(14, 165, 233, 0.9); /* bg-sky-500 with opacity */
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            z-index: 5;
            backdrop-filter: blur(8px);
        }

        /* è§†é¢‘ä¿¡æ¯åŒºåŸŸ */
        .video-info {
            padding: 24px;
            border-top: 1px solid rgba(55, 65, 81, 0.3); /* border-gray-700 with opacity */
        }

        .video-title {
            font-weight: 700;
            color: #f9fafb; /* text-white */
            margin-bottom: 12px;
            font-size: 16px; /* text-base */
            line-height: 1.4;
            letter-spacing: -0.025em; /* tracking-tight */
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #9ca3af; /* text-gray-400 */
            font-size: 13px; /* text-sm */
            line-height: 1.4;
            letter-spacing: 0.025em;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(75, 101, 115, 0.5); /* bg-gray-600 with opacity */
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #0ea5e9; /* bg-sky-500 */
            border-radius: 2px;
            transition: width 0.1s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #0ea5e9; /* bg-sky-500 */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.4);
        }

        /* ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€ */
        .loading-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af; /* text-gray-400 */
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(8px);
            font-size: 14px; /* text-sm */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        .loading-state i {
            font-size: 32px;
            animation: spin 1s linear infinite;
            margin-bottom: 12px;
            color: #0ea5e9; /* text-sky-500 */
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af; /* text-gray-400 */
            display: none;
            background: rgba(31, 41, 55, 0.8); /* bg-gray-800 with opacity */
            border-radius: 16px;
            border: 1px solid rgba(55, 65, 81, 0.3); /* ring-1 ring-gray-700 */
            backdrop-filter: blur(8px);
            font-size: 14px; /* text-sm */
            line-height: 1.5;
            letter-spacing: 0.025em;
        }

        .empty-state i {
            font-size: 48px;
            color: #6b7280; /* text-gray-500 */
            margin-bottom: 16px;
        }

        /* é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(31, 41, 55, 0.95); /* bg-gray-800 with opacity */
            color: #f9fafb; /* text-white */
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(55, 65, 81, 0.5); /* border-gray-700 with opacity */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1500;
            backdrop-filter: blur(8px);
            max-width: 300px;
            font-size: 14px; /* text-sm */
            line-height: 1.4;
            letter-spacing: 0.025em;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #0ea5e9; /* ring-sky-500 */
        }

        .notification.error {
            border-left: 4px solid #ef4444; /* ring-red-500 */
        }

        .notification i {
            margin-right: 8px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .nav-container {
                height: 60px;
            }

            .container {
                padding: 135px 16px 16px;
            }

            .logo img {
                height: 48px;
                margin: 0;
                padding: 0;
                vertical-align: middle;
                display: block;
            }

            .nav-links {
                display: none;
            }

            .video-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 0 8px;
                max-width: none;
            }

            .library-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .page-header h1 {
                font-size: clamp(22px, 6.5vw, 28px); /* è‡ªé€‚åº”å­—å·ï¼Œé¿å…æ¢è¡Œ */
                line-height: 1.2;
                letter-spacing: -0.025em;
                white-space: nowrap;          /* ç¦æ­¢æ¢è¡Œ */
                word-break: keep-all;         /* ä¸­æ–‡å°½é‡ä¸æ‹†åˆ† */
                overflow: hidden;             /* è¶…å‡ºéšè— */
                text-overflow: ellipsis;      /* è¶…å‡ºæ˜¾ç¤ºçœç•¥å· */
            }

            .page-header p {
                font-size: clamp(13px, 4.2vw, 16px); /* è‡ªé€‚åº”å­—å·ï¼Œé¿å…æ¢è¡Œ */
                line-height: 1.4;
                letter-spacing: 0.01em;
                white-space: nowrap;          /* ç¦æ­¢æ¢è¡Œ */
                word-break: keep-all;         /* ä¸­æ–‡å°½é‡ä¸æ‹†åˆ† */
                overflow: hidden;             /* è¶…å‡ºéšè— */
                text-overflow: ellipsis;      /* è¶…å‡ºæ˜¾ç¤ºçœç•¥å· */
            }

            .video-player-container {
                aspect-ratio: 16/9;
            }

            .play-button {
                width: 50px;
                height: 50px;
            }

            .play-button i {
                font-size: 20px;
            }

            .notification {
                right: 16px;
                left: 16px;
                min-width: auto;
                max-width: none;
                text-align: center;
            }

            .preload-indicator {
                left: 16px;
                font-size: 11px;
                padding: 6px 10px;
            }

            .settings-content {
                margin: 10px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .video-info {
                padding: 12px;
            }

            .video-title {
                font-size: 13px; /* text-sm */
                line-height: 1.4;
                letter-spacing: -0.025em;
            }

            .video-meta {
                font-size: 11px; /* text-xs */
                line-height: 1.4;
                letter-spacing: 0.025em;
            }
        }

        /* å…¨å±æ ·å¼ */
        .video-card.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            border-radius: 0;
            width: 100%;
            height: 100%;
        }

        .video-card.fullscreen .video-player-container {
            height: calc(100% - 120px);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #374151; /* bg-gray-700 */
        }

        ::-webkit-scrollbar-thumb {
            background: #6b7280; /* bg-gray-500 */
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* bg-gray-400 */
        }

        /* åŠ¨ç”» */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ç¼©ç•¥å›¾æ·¡å…¥åŠ¨ç”» */
        @keyframes thumbnailFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-thumbnail.fade-in {
            animation: thumbnailFadeIn 0.5s ease-in-out;
        }

        /* é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢ç¼©æ”¾ */
        html {
            touch-action: pan-x pan-y;
            -webkit-text-size-adjust: none;
            -ms-text-size-adjust: none;
        }

        /* ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸé€‚é… */
        @supports (padding-top: env(safe-area-inset-top)) {
            .header {
                padding-top: env(safe-area-inset-top);
                height: calc(60px + env(safe-area-inset-top));
            }

            .container {
                padding-top: calc(135px + env(safe-area-inset-top));
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <header class="header" id="header">
        <div class="nav-container">
            <a href="#" class="logo">
                <img src="/static/logo/logo1.png">
            </a>
        </div>
    </header>

    <!-- é¢„åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div class="preload-indicator" id="preloadIndicator">
        <i class="fas fa-spinner"></i>
        <span>æ­£åœ¨é¢„åŠ è½½è§†é¢‘...</span>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1>å‡¤å‡°çœ¼è§†è§‰é«˜ç»´æ™ºèƒ½è§‚èµ›</h1>
            <p>æ²‰æµ¸ä½“éªŒç«æŠ€ç²¾å½©æ—¶åˆ»ï¼Œäº«å—é«˜ç»´è§†è§‰ç››å®´</p>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading-state" id="loading">
            <i class="fas fa-spinner"></i>
            <p>æ­£åœ¨åŠ è½½è§†é¢‘åˆ—è¡¨...</p>
        </div>

        <!-- è§†é¢‘ç½‘æ ¼ -->
        <div class="video-grid" id="videoGrid">
            <!-- è§†é¢‘åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState">
            <i class="fas fa-video-slash"></i>
            <h3>æš‚æ— è§†é¢‘å†…å®¹</h3>
            <p>è¯·æ·»åŠ è§†é¢‘æ–‡ä»¶åˆ°æœåŠ¡å™¨</p>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel" id="settingsPanel" onclick="hideSettings(event)">
        <div class="settings-content" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h3>æ’­æ”¾è®¾ç½®</h3>
                <button class="close-settings" onclick="hideSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘</div>
                    <div class="setting-desc">æ’­æ”¾æ–°è§†é¢‘æ—¶è‡ªåŠ¨åœæ­¢å…¶ä»–æ­£åœ¨æ’­æ”¾çš„è§†é¢‘</div>
                </div>
                <div class="switch active" id="autoStopSwitch" onclick="toggleAutoStop()">
                </div>
            </div>
            
            <div class="setting-item">
                <div>
                    <div class="setting-label">é¢„åŠ è½½è§†é¢‘</div>
                    <div class="setting-desc">é¢„å…ˆåŠ è½½éƒ¨åˆ†è§†é¢‘ä»¥æé«˜æ’­æ”¾æµç•…åº¦</div>
                </div>
                <div class="switch active" id="preloadSwitch" onclick="togglePreload()">
                </div>
            </div>

            <div class="setting-item">
                <div>
                    <div class="setting-label">è‡ªåŠ¨åŠ è½½å°é¢</div>
                    <div class="setting-desc">é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºè§†é¢‘å°é¢</div>
                </div>
                <div class="switch active" id="thumbnailSwitch" onclick="toggleThumbnail()">
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let videoList = [];
        let activeVideos = new Map(); // å­˜å‚¨æ´»åŠ¨çš„è§†é¢‘æ’­æ”¾å™¨
        let preloadedVideos = new Set();
        let thumbnailsLoaded = new Set();
        let iosVideoStates = new Map(); // iOSè®¾å¤‡ä¸Šçš„è§†é¢‘çŠ¶æ€ç®¡ç†
        
        // æ”¹è¿›ç§»åŠ¨ç«¯å’ŒiOSæ£€æµ‹
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        let isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        
        let userHasInteracted = false;

        // ç”¨æˆ·è®¾ç½®
        let settings = {
            autoStop: true,       // è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘
            preload: true,        // é¢„åŠ è½½è§†é¢‘
            thumbnail: true       // è‡ªåŠ¨åŠ è½½å°é¢
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ å¼€å§‹åŠ è½½è§†é¢‘åˆ—è¡¨...');
            console.log('è®¾å¤‡ä¿¡æ¯:', { isMobile, isIOS, isSafari });
            loadSettings();
            loadVideoList();
            setupUserInteractionTracking();
            setupMobileOptimizations();
            setupKeyboardControls();
            
            // iOSç‰¹æ®Šåˆå§‹åŒ–
            if (isIOS) {
                setupIOSOptimizations();
            }
        });

        // iOSä¸“ç”¨ä¼˜åŒ–è®¾ç½®
        function setupIOSOptimizations() {
            console.log('ğŸ è®¾ç½®iOSä¸“ç”¨ä¼˜åŒ–...');
            
            // æ·»åŠ iOSç‰¹æ®Šçš„viewport metaæ ‡ç­¾
            const viewportMeta = document.querySelector('meta[name="viewport"]');
            if (viewportMeta) {
                viewportMeta.content += ', user-scalable=no';
            }
            
            // ç¦ç”¨iOSç‰¹æ®Šæ‰‹åŠ¿
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            document.addEventListener('gesturechange', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
            
            document.addEventListener('gestureend', function(e) {
                e.preventDefault();
                e.stopPropagation();
            }, { passive: false });
        }

        // åŠ è½½ç”¨æˆ·è®¾ç½®
        function loadSettings() {
            updateSettingsUI();
        }

        // æ›´æ–°è®¾ç½®ç•Œé¢
        function updateSettingsUI() {
            document.getElementById('autoStopSwitch').classList.toggle('active', settings.autoStop);
            document.getElementById('preloadSwitch').classList.toggle('active', settings.preload);
            document.getElementById('thumbnailSwitch').classList.toggle('active', settings.thumbnail);
        }

        // æ˜¾ç¤ºè®¾ç½®é¢æ¿
        function showSettings() {
            document.getElementById('settingsPanel').style.display = 'flex';
            updateSettingsUI();
        }

        // éšè—è®¾ç½®é¢æ¿
        function hideSettings(event) {
            if (!event || event.target.id === 'settingsPanel') {
                document.getElementById('settingsPanel').style.display = 'none';
            }
        }

        // åˆ‡æ¢è‡ªåŠ¨åœæ­¢è®¾ç½®
        function toggleAutoStop() {
            settings.autoStop = !settings.autoStop;
            updateSettingsUI();
            showNotification(
                settings.autoStop ? 'å·²å¯ç”¨è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘' : 'å·²ç¦ç”¨è‡ªåŠ¨åœæ­¢å…¶ä»–è§†é¢‘', 
                'success'
            );
        }

        // åˆ‡æ¢é¢„åŠ è½½è®¾ç½®
        function togglePreload() {
            settings.preload = !settings.preload;
            updateSettingsUI();
            showNotification(
                settings.preload ? 'å·²å¯ç”¨è§†é¢‘é¢„åŠ è½½' : 'å·²ç¦ç”¨è§†é¢‘é¢„åŠ è½½', 
                'success'
            );
        }

        // åˆ‡æ¢å°é¢è®¾ç½®
        function toggleThumbnail() {
            settings.thumbnail = !settings.thumbnail;
            updateSettingsUI();
            showNotification(
                settings.thumbnail ? 'å·²å¯ç”¨è‡ªåŠ¨åŠ è½½å°é¢' : 'å·²ç¦ç”¨è‡ªåŠ¨åŠ è½½å°é¢', 
                'success'
            );
            
            if (settings.thumbnail && videoList.length > 0) {
                loadThumbnails();
            }
        }

        // åŠ è½½è§†é¢‘åˆ—è¡¨
        async function loadVideoList() {
            try {
                showLoading(true);
                showPreloadIndicator(true, 'æ­£åœ¨è·å–è§†é¢‘åˆ—è¡¨...');
                
                const response = await fetch('/api/get_video_list');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    videoList = data.videos || [];
                    
                    if (videoList.length > 0) {
                        renderVideoGrid();
                        
                        // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦é¢„åŠ è½½
                        if (settings.preload) {
                            preloadVideos();
                        }

                        // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åŠ è½½å°é¢
                        if (settings.thumbnail) {
                            loadThumbnails();
                        }
                    } else {
                        showEmptyState();
                    }
                } else {
                    throw new Error(data.message || 'è·å–è§†é¢‘åˆ—è¡¨å¤±è´¥');
                }
                
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', error);
                showNotification('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', 'error');
                showEmptyState();
            } finally {
                showLoading(false);
                showPreloadIndicator(false);
            }
        }

        // æ¸²æŸ“è§†é¢‘ç½‘æ ¼
        function renderVideoGrid() {
            const videoGrid = document.getElementById('videoGrid');
            const emptyState = document.getElementById('emptyState');
            
            emptyState.style.display = 'none';
            videoGrid.innerHTML = '';
            videoGrid.style.display = 'grid';

            videoList.forEach((video, index) => {
                const card = createVideoCard(video, index);
                videoGrid.appendChild(card);
            });
        }

        // åˆ›å»ºè§†é¢‘å¡ç‰‡ï¼ˆä¿®å¤ç¼©ç•¥å›¾åŠ è½½ï¼‰
        function createVideoCard(video, index) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.id = `video-card-${index}`;
            card.setAttribute('data-index', index);
            card.setAttribute('data-filename', video.filename);

            const sizeText = video.size ? formatFileSize(video.size) : 'æœªçŸ¥å¤§å°';
            const modifiedText = video.modified ? formatDate(new Date(video.modified)) : 'æœªçŸ¥æ—¥æœŸ';

            card.innerHTML = `
                <div class="video-player-container" id="player-container-${index}">
                    <!-- ç¼©ç•¥å›¾å ä½ç¬¦ -->
                    <div class="thumbnail-placeholder" id="placeholder-${index}">
                        <div style="text-align: center;">
                            <i class="fas fa-video"></i>
                        </div>
                    </div>
                    
                    <!-- é™æ€å°é¢å›¾ç‰‡ - ä¿®å¤åŠ è½½é—®é¢˜ -->
                    <img 
                        id="thumbnail-${index}" 
                        class="video-thumbnail"
                        alt="è§†é¢‘å°é¢"
                        crossorigin="anonymous"
                        loading="eager" />
                    
                    <!-- ä¸»æ’­æ”¾å™¨ - iOSä¼˜åŒ–ç‰ˆ -->
                    <video 
                        id="video-${index}" 
                        class="video-player"
                        preload="none"
                        playsinline 
                        webkit-playsinline
                        x5-video-player-type="h5"
                        x5-video-player-fullscreen="true"
                        x5-video-orientation="portrait"
                        style="display: none;"
                        ${isMobile ? 'controls' : ''}
                        muted="${isIOS}">
                        <source src="/api/stream_video/${encodeURIComponent(video.filename)}" type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                    </video>
                    
                    <div class="play-overlay" id="overlay-${index}">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    
                    <div class="video-loading" id="loading-${index}">
                        <i class="fas fa-spinner"></i>
                    </div>
                    
                    <!-- iOSæç¤ºæ–‡æœ¬ -->
                    ${isIOS ? `<div class="ios-hint" id="hint-${index}">å‡†å¤‡æ’­æ”¾ä¸­ï¼Œè¯·ç¨å€™...</div>` : ''}
                </div>
                
                <div class="video-info">
                    <div class="video-title" title="${video.filename}">
                        ${video.name || video.filename}
                    </div>
                    <div class="video-meta">
                        <span><i class="fas fa-file"></i> ${sizeText}</span>
                        <span><i class="fas fa-calendar"></i> ${modifiedText}</span>
                    </div>
                </div>
            `;

            // è®¾ç½®è§†é¢‘äº‹ä»¶ç›‘å¬
            setTimeout(() => {
                setupVideoEvents(index);
            }, 0);

            return card;
        }

        // ä¿®å¤è§†é¢‘äº‹ä»¶è®¾ç½®
        function setupVideoEvents(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const container = document.getElementById(`player-container-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            
            if (!video) return;

            // åˆå§‹åŒ–iOSè§†é¢‘çŠ¶æ€
            if (isIOS) {
                iosVideoStates.set(index, {
                    isReady: false,
                    isLoading: false,
                    hasUserInteracted: false
                });
            }

            // iOSä¼˜åŒ–çš„æ’­æ”¾æŒ‰é’®äº‹ä»¶å¤„ç†
            if (overlay) {
                overlay.onclick = null; // ç§»é™¤å†…è”äº‹ä»¶
                
                const playHandler = async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // iOSè®¾å¤‡ç‰¹æ®Šå¤„ç†
                    if (isIOS) {
                        await handleIOSVideoPlay(index);
                    } else {
                        await playVideo(index);
                    }
                };
                
                // æ·»åŠ å¤šç§äº‹ä»¶ç¡®ä¿iOSå…¼å®¹
                overlay.addEventListener('click', playHandler, { passive: false });
                overlay.addEventListener('touchend', playHandler, { passive: false });
                
                // é˜²æ­¢iOSåŒå‡»ç¼©æ”¾
                overlay.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                }, { passive: false });
            }

            // ä¿®å¤ç¼©ç•¥å›¾åŠ è½½äº‹ä»¶
            if (thumbnail) {
                const onLoad = () => {
                    if (thumbnailsLoaded.has(index)) return;
                    console.log(`âœ… ç¼©ç•¥å›¾åŠ è½½æˆåŠŸ: ${index}`);
                    showThumbnail(index);
                    thumbnailsLoaded.add(index);
                };
                
                const onError = (e) => {
                    console.error(`âŒ ç¼©ç•¥å›¾åŠ è½½å¤±è´¥: ${index}`, e);
                    showThumbnailError(index);
                };
                
                thumbnail.addEventListener('load', onLoad, { once: true });
                thumbnail.addEventListener('error', onError, { once: true });
            }

            // è§†é¢‘æ’­æ”¾å™¨äº‹ä»¶ç›‘å¬ - iOSä¼˜åŒ–ç‰ˆ
            video.addEventListener('loadstart', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} å¼€å§‹åŠ è½½ (iOS: ${isIOS})`);
                showLoadingIndicator(index, true);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = true;
                        iosVideoStates.set(index, state);
                    }
                }
            });

            video.addEventListener('loadedmetadata', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} å…ƒæ•°æ®å·²åŠ è½½`);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isReady = true;
                        iosVideoStates.set(index, state);
                    }
                    // iOSè®¾å¤‡ä¸Šç¡®ä¿æ§ä»¶æ˜¾ç¤º
                    video.controls = true;
                    hideIOSHint(index);
                }
            });

            video.addEventListener('canplay', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} å¯ä»¥æ’­æ”¾`);
                showLoadingIndicator(index, false);
                if (isIOS) {
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = false;
                        iosVideoStates.set(index, state);
                    }
                    hideIOSHint(index);
                }
            });

            video.addEventListener('play', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} å¼€å§‹æ’­æ”¾`);
                const card = document.getElementById(`video-card-${index}`);
                if (card) {
                    card.classList.add('playing');
                    card.classList.remove('ios-preparing');
                }
                
                // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åœæ­¢å…¶ä»–è§†é¢‘
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
            });

            video.addEventListener('pause', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} æš‚åœ`);
                const card = document.getElementById(`video-card-${index}`);
                if (card) {
                    card.classList.remove('playing');
                }
            });

            video.addEventListener('ended', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} æ’­æ”¾ç»“æŸ`);
                resetVideo(index);
                showNotification('è§†é¢‘æ’­æ”¾å®Œæˆ', 'success');
            });

            // iOSä¼˜åŒ–çš„é”™è¯¯å¤„ç†
            video.addEventListener('error', (e) => {
                console.error(`ğŸ“± è§†é¢‘ ${index} åŠ è½½å¤±è´¥:`, e);
                console.error('é”™è¯¯è¯¦æƒ…:', video.error);
                showLoadingIndicator(index, false);
                
                if (isIOS) {
                    hideIOSHint(index);
                    const state = iosVideoStates.get(index);
                    if (state) {
                        state.isLoading = false;
                        state.isReady = false;
                        iosVideoStates.set(index, state);
                    }
                }
                
                let errorMsg = 'è§†é¢‘åŠ è½½å¤±è´¥';
                if (video.error) {
                    switch(video.error.code) {
                        case 1: errorMsg = 'è§†é¢‘åŠ è½½è¢«ä¸­æ­¢'; break;
                        case 2: errorMsg = isIOS ? 'iOSç½‘ç»œé”™è¯¯ï¼Œå»ºè®®ä½¿ç”¨HTTPS' : 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥'; break;
                        case 3: errorMsg = 'è§†é¢‘è§£ç å¤±è´¥'; break;
                        case 4: errorMsg = 'è§†é¢‘æ ¼å¼ä¸æ”¯æŒ'; break;
                    }
                }
                showNotification(errorMsg, 'error');
            });

            // iOSç‰¹æ®Šçš„ç­‰å¾…å’Œç¼“å†²äº‹ä»¶
            video.addEventListener('waiting', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} ç¼“å†²ä¸­...`);
                showLoadingIndicator(index, true);
                if (isIOS) {
                    showIOSHint(index, 'ç¼“å†²ä¸­ï¼Œè¯·ç¨å€™...');
                }
            });

            video.addEventListener('canplaythrough', () => {
                console.log(`ğŸ“± è§†é¢‘ ${index} å¯æµç•…æ’­æ”¾`);
                showLoadingIndicator(index, false);
                if (isIOS) {
                    hideIOSHint(index);
                }
            });
        }

        // iOSä¸“ç”¨çš„è§†é¢‘æ’­æ”¾å¤„ç†
        async function handleIOSVideoPlay(index) {
            console.log(`ğŸ iOSè®¾å¤‡æ’­æ”¾è§†é¢‘: ${index}`);
            
            const video = document.getElementById(`video-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (!video) return;
            
            try {
                // æ˜¾ç¤ºå‡†å¤‡çŠ¶æ€
                card.classList.add('ios-preparing');
                showIOSHint(index, 'æ­£åœ¨å‡†å¤‡æ’­æ”¾...');
                
                // ç¦ç”¨æ’­æ”¾æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
                overlay.classList.add('ios-disabled');
                
                // æ˜¾ç¤ºè§†é¢‘å…ƒç´ å¹¶å¼€å§‹åŠ è½½
                await showVideoPlayer(index);
                
                // è®°å½•æ´»åŠ¨è§†é¢‘
                activeVideos.set(index, video);
                
                // æ ¹æ®è®¾ç½®åœæ­¢å…¶ä»–è§†é¢‘
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
                
                // ç›´æ¥å°è¯•æ’­æ”¾ï¼Œä¸ç­‰å¾…å¤æ‚çš„çŠ¶æ€
                console.log('ğŸ å¼€å§‹iOSè§†é¢‘æ’­æ”¾...');
                showIOSHint(index, 'å¼€å§‹æ’­æ”¾...');
                
                // iOSè®¾å¤‡å¯èƒ½éœ€è¦å…ˆåŠ è½½å†æ’­æ”¾
                const playPromise = video.play();
                if (playPromise) {
                    await playPromise;
                }
                
                console.log(`ğŸ iOSè§†é¢‘ ${index} æ’­æ”¾æˆåŠŸ`);
                hideIOSHint(index);
                
            } catch (error) {
                console.error(`ğŸ iOSæ’­æ”¾å¤±è´¥: ${index}`, error);
                
                // é”™è¯¯å¤„ç†
                if (error.name === 'NotAllowedError') {
                    showIOSHint(index, 'è¯·ç‚¹å‡»è§†é¢‘æ’­æ”¾æŒ‰é’®');
                    showNotification('iOSéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ’­æ”¾', 'error');
                } else {
                    showIOSHint(index, 'æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•');
                    showNotification('iOSæ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    resetVideo(index);
                }
            } finally {
                // æ¢å¤æ’­æ”¾æŒ‰é’®
                overlay.classList.remove('ios-disabled');
                card.classList.remove('ios-preparing');
            }
        }

        // æ ‡å‡†æ’­æ”¾è§†é¢‘å‡½æ•°ï¼ˆéiOSï¼‰
        async function playVideo(index) {
            const video = document.getElementById(`video-${index}`);
            
            if (!video) {
                console.error(`è§†é¢‘å…ƒç´ æœªæ‰¾åˆ°: video-${index}`);
                return;
            }

            console.log(`æ’­æ”¾è§†é¢‘ ${index}`);

            try {
                // æ˜¾ç¤ºè§†é¢‘æ’­æ”¾å™¨
                await showVideoPlayer(index);
                
                // è®°å½•æ´»åŠ¨è§†é¢‘
                activeVideos.set(index, video);
                
                // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦åœæ­¢å…¶ä»–è§†é¢‘
                if (settings.autoStop) {
                    stopOtherVideos(index);
                }
                
                // å¼€å§‹æ’­æ”¾
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    await playPromise;
                    console.log(`âœ… è§†é¢‘ ${index} æ’­æ”¾æˆåŠŸ`);
                    
                    // æ’­æ”¾æˆåŠŸåæ˜¾ç¤ºæ§ä»¶ï¼ˆéç§»åŠ¨ç«¯ï¼‰
                    if (!isMobile) {
                        video.controls = true;
                    }
                }
                
            } catch (error) {
                console.error(`æ’­æ”¾å¤±è´¥: ${index}`, error);
                
                if (error.name === 'NotAllowedError') {
                    console.log('å°è¯•é™éŸ³æ’­æ”¾...');
                    video.muted = true;
                    try {
                        await video.play();
                        video.controls = true;
                        showNotification('è§†é¢‘å·²é™éŸ³æ’­æ”¾ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼‰', 'error');
                        console.log(`âœ… è§†é¢‘ ${index} é™éŸ³æ’­æ”¾æˆåŠŸ`);
                    } catch (e) {
                        console.error('é™éŸ³æ’­æ”¾ä¹Ÿå¤±è´¥:', e);
                        showNotification('è¯·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®', 'error');
                        resetVideo(index);
                    }
                } else {
                    showNotification('æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    resetVideo(index);
                }
            }
        }

        // æ˜¾ç¤ºè§†é¢‘æ’­æ”¾å™¨çš„é€šç”¨å‡½æ•°
        async function showVideoPlayer(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const loadingIndicator = document.getElementById(`loading-${index}`);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoadingIndicator(index, true);
            overlay.classList.add('hidden');
            
            // æ˜¾ç¤ºä¸»æ’­æ”¾å™¨ï¼Œéšè—ç¼©ç•¥å›¾
            video.style.display = 'block';
            if (thumbnail) {
                thumbnail.style.display = 'none';
            }
            
            // iOSè®¾å¤‡éœ€è¦æ˜¾å¼å¼€å§‹åŠ è½½è§†é¢‘æ•°æ®
            if (isIOS) {
                video.preload = 'metadata';
                video.load(); // æ˜¾å¼åŠ è½½è§†é¢‘å…ƒæ•°æ®
                console.log(`ğŸ iOSè®¾å¤‡å¼€å§‹åŠ è½½è§†é¢‘å…ƒæ•°æ®: ${index}`);
            }
        }

        // æ˜¾ç¤ºiOSæç¤º
        function showIOSHint(index, message) {
            const hint = document.getElementById(`hint-${index}`);
            if (hint) {
                hint.textContent = message;
                hint.classList.add('show');
            }
        }

        // éšè—iOSæç¤º
        function hideIOSHint(index) {
            const hint = document.getElementById(`hint-${index}`);
            if (hint) {
                hint.classList.remove('show');
            }
        }

        // æ˜¾ç¤ºç¼©ç•¥å›¾
        function showThumbnail(index) {
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const placeholder = document.getElementById(`placeholder-${index}`);
            
            if (thumbnail && placeholder) {
                placeholder.style.display = 'none';
                thumbnail.style.display = 'block';
                thumbnail.classList.add('loaded', 'fade-in');
                console.log(`âœ… ç¼©ç•¥å›¾æ˜¾ç¤ºæˆåŠŸ: ${index}`);
            }
        }

        // æ”¹è¿›ç¼©ç•¥å›¾é”™è¯¯æ˜¾ç¤º
        function showThumbnailError(index) {
            const placeholder = document.getElementById(`placeholder-${index}`);
            
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="text-align: center; color: #9ca3af;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>å°é¢åŠ è½½å¤±è´¥</div>
                        ${isIOS ? '<div style="font-size: 12px; margin-top: 4px;">iOSè®¾å¤‡å¯èƒ½éœ€è¦HTTPS</div>' : ''}
                    </div>
                `;
            }
        }

        // ä¿®å¤ç¼©ç•¥å›¾åŠ è½½å‡½æ•° - ç»Ÿä¸€å¤„ç†æ‰€æœ‰è®¾å¤‡
        function loadThumbnails() {
            if (!settings.thumbnail) return;
            
            console.log('ğŸ–¼ï¸ å¼€å§‹ç»Ÿä¸€åŠ è½½ç¼©ç•¥å›¾ï¼Œè®¾å¤‡ä¿¡æ¯:', { isIOS, isSafari, isMobile });
            showPreloadIndicator(true, 'æ­£åœ¨åŠ è½½è§†é¢‘å°é¢...');
            
            let loadedCount = 0;
            const totalCount = videoList.length;
            
            videoList.forEach((video, index) => {
                const thumbnail = document.getElementById(`thumbnail-${index}`);
                if (thumbnail && !thumbnailsLoaded.has(index)) {
                    const checkLoaded = () => {
                        loadedCount++;
                        console.log(`ç¼©ç•¥å›¾åŠ è½½è¿›åº¦: ${loadedCount}/${totalCount}`);
                        if (loadedCount >= totalCount) {
                            showPreloadIndicator(false);
                            console.log('æ‰€æœ‰ç¼©ç•¥å›¾åŠ è½½å®Œæˆ');
                        }
                    };
                    
                    thumbnail.addEventListener('load', checkLoaded, { once: true });
                    thumbnail.addEventListener('error', checkLoaded, { once: true });
                    
                    // æ‰€æœ‰è®¾å¤‡ç»Ÿä¸€è®¾ç½® - ç¡®ä¿å¼ºåˆ¶åŠ è½½
                    thumbnail.loading = 'eager';
                    const imageUrl = `/api/video_cover/${encodeURIComponent(video.filename)}`;
                    
                    // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜é—®é¢˜
                    const cacheBustUrl = imageUrl + (imageUrl.includes('?') ? '&' : '?') + 't=' + Date.now();
                    
                    // è®¾ç½®srcè§¦å‘åŠ è½½
                    thumbnail.src = cacheBustUrl;
                    console.log(`ğŸ–¼ï¸ è®¾ç½®ç¼©ç•¥å›¾URL: ${index} -> ${cacheBustUrl}`);
                }
            });
            
            // è¶…æ—¶å¤„ç†
            setTimeout(() => {
                if (loadedCount < totalCount) {
                    showPreloadIndicator(false);
                    console.log(`ç¼©ç•¥å›¾åŠ è½½è¶…æ—¶ï¼Œå·²åŠ è½½: ${loadedCount}/${totalCount}`);
                }
            }, 15000);
        }

        // åœæ­¢å…¶ä»–è§†é¢‘
        function stopOtherVideos(currentIndex) {
            activeVideos.forEach((video, index) => {
                if (index !== currentIndex && !video.paused) {
                    video.pause();
                    resetVideo(index);
                }
            });
        }

        // åœæ­¢æ‰€æœ‰è§†é¢‘
        function stopAllVideos() {
            activeVideos.forEach((video, index) => {
                if (!video.paused) {
                    video.pause();
                }
                resetVideo(index);
            });
            activeVideos.clear();
            showNotification('å·²åœæ­¢æ‰€æœ‰è§†é¢‘', 'success');
        }

        // é‡ç½®è§†é¢‘
        function resetVideo(index) {
            const video = document.getElementById(`video-${index}`);
            const thumbnail = document.getElementById(`thumbnail-${index}`);
            const overlay = document.getElementById(`overlay-${index}`);
            const card = document.getElementById(`video-card-${index}`);
            
            if (video) {
                video.currentTime = 0;
                video.style.display = 'none';
                video.preload = 'none';
                if (!isMobile) {
                    video.controls = false;
                }
            }
            
            // é‡æ–°æ˜¾ç¤ºç¼©ç•¥å›¾
            if (thumbnail && thumbnailsLoaded.has(index)) {
                thumbnail.style.display = 'block';
            }
            
            if (overlay) {
                overlay.classList.remove('hidden', 'ios-disabled');
            }
            
            if (card) {
                card.classList.remove('playing', 'ios-preparing');
            }
            
            // éšè—iOSæç¤º
            if (isIOS) {
                hideIOSHint(index);
                // é‡ç½®iOSçŠ¶æ€
                const state = iosVideoStates.get(index);
                if (state) {
                    state.hasUserInteracted = false;
                    iosVideoStates.set(index, state);
                }
            }
            
            activeVideos.delete(index);
        }

        // é¢„åŠ è½½è§†é¢‘
        async function preloadVideos() {
            if (!settings.preload) return;
            
            console.log('å¼€å§‹é¢„åŠ è½½è§†é¢‘ï¼Œè®¾å¤‡:', { isIOS, isSafari });
            showPreloadIndicator(true, 'æ­£åœ¨é¢„åŠ è½½è§†é¢‘...');
            
            // iOSè®¾å¤‡å‡å°‘é¢„åŠ è½½æ•°é‡
            const preloadCount = Math.min(isIOS ? 1 : 2, videoList.length);
            
            for (let i = 0; i < preloadCount; i++) {
                try {
                    const chunkSize = isIOS ? 131072 : 262144; // iOSç”¨æ›´å°çš„å—
                    const response = await fetch(`/api/preload_chunk/${encodeURIComponent(videoList[i].filename)}?chunk_size=${chunkSize}`);
                    
                    if (response.ok) {
                        await response.blob();
                        preloadedVideos.add(videoList[i].filename);
                        console.log(`âœ… é¢„åŠ è½½å®Œæˆ: ${videoList[i].filename}`);
                    }
                } catch (error) {
                    console.warn(`é¢„åŠ è½½å¤±è´¥: ${videoList[i].filename}`, error);
                }
            }
            
            showPreloadIndicator(false);
        }

        // åˆ·æ–°è§†é¢‘åˆ—è¡¨
        async function refreshVideoList() {
            showNotification('æ­£åœ¨åˆ·æ–°è§†é¢‘åˆ—è¡¨...', 'success');
            stopAllVideos();
            preloadedVideos.clear();
            thumbnailsLoaded.clear();
            if (isIOS) {
                iosVideoStates.clear();
            }
            await loadVideoList();
        }

        // æ˜¾ç¤ºé¢„åŠ è½½æŒ‡ç¤ºå™¨
        function showPreloadIndicator(show, message = 'æ­£åœ¨é¢„åŠ è½½è§†é¢‘...') {
            const indicator = document.getElementById('preloadIndicator');
            const span = indicator.querySelector('span');
            
            if (show) {
                span.textContent = message;
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // æ”¹è¿›ç”¨æˆ·äº¤äº’è·Ÿè¸ª
        function setupUserInteractionTracking() {
            const interactionEvents = ['click', 'touchstart', 'touchend', 'keydown'];
            
            function markUserInteraction() {
                userHasInteracted = true;
                console.log('âœ… ç”¨æˆ·å·²äº¤äº’, è®¾å¤‡:', { isIOS, isSafari });
                interactionEvents.forEach(event => {
                    document.removeEventListener(event, markUserInteraction);
                });
            }
            
            interactionEvents.forEach(event => {
                document.addEventListener(event, markUserInteraction, { 
                    once: true,
                    passive: event.includes('touch')
                });
            });
        }

        // æ”¹è¿›ç§»åŠ¨ç«¯ä¼˜åŒ–
        function setupMobileOptimizations() {
            console.log('è®¾ç½®ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼Œè®¾å¤‡ä¿¡æ¯:', { isMobile, isIOS, isSafari });
            
            if (isMobile) {
                // é˜²æ­¢åŒå‡»ç¼©æ”¾
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, { passive: false });

                // iOSç‰¹æ®Šä¼˜åŒ–
                if (isIOS) {
                    // æ·»åŠ iOSç‰¹å®šçš„metaæ ‡ç­¾
                    if (!document.querySelector('meta[name="format-detection"]')) {
                        const meta = document.createElement('meta');
                        meta.name = 'format-detection';
                        meta.content = 'telephone=no';
                        document.head.appendChild(meta);
                    }
                }

                // ä¼˜åŒ–è§†é¢‘æ’­æ”¾å±æ€§
                setTimeout(() => {
                    document.querySelectorAll('video').forEach(video => {
                        video.setAttribute('playsinline', 'true');
                        video.setAttribute('webkit-playsinline', 'true');
                        video.setAttribute('x5-video-player-type', 'h5');
                        
                        if (isIOS) {
                            video.setAttribute('x5-video-player-fullscreen', 'true');
                            video.setAttribute('x5-video-orientation', 'portrait');
                        }
                    });
                }, 1000);
            }
        }

        // é”®ç›˜æ§åˆ¶
        function setupKeyboardControls() {
            if (!isMobile) {
                document.addEventListener('keydown', function(e) {
                    if (e.key === ' ') {
                        e.preventDefault();
                        const playingVideos = Array.from(activeVideos.keys());
                        if (playingVideos.length > 0) {
                            const video = activeVideos.get(playingVideos[0]);
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                        }
                    }
                    else if (e.key === 'Escape') {
                        stopAllVideos();
                    }
                });
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-info-circle';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'block' : 'none';
        }

        // æ”¹è¿›åŠ è½½æŒ‡ç¤ºå™¨
        function showLoadingIndicator(index, show) {
            const loadingIndicator = document.getElementById(`loading-${index}`);
            if (loadingIndicator) {
                if (show) {
                    loadingIndicator.classList.add('show');
                } else {
                    loadingIndicator.classList.remove('show');
                }
            }
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState() {
            const emptyState = document.getElementById('emptyState');
            const videoGrid = document.getElementById('videoGrid');
            
            emptyState.style.display = 'block';
            videoGrid.style.display = 'none';
        }

        // å·¥å…·å‡½æ•°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatDate(date) {
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // é¡µé¢å¯è§æ€§å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                activeVideos.forEach((video) => {
                    if (!video.paused) {
                        video.pause();
                    }
                });
            }
        });

        // é¡µé¢å¸è½½æ—¶çš„æ¸…ç†
        window.addEventListener('beforeunload', function() {
            activeVideos.forEach((video) => {
                video.pause();
                video.currentTime = 0;
                video.src = '';
                video.load();
            });
        });
    </script>
</body>
</html>